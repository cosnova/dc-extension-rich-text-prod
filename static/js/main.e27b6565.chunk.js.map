{"version":3,"sources":["../../common/dist/languages/index.js","../../common/dist/languages/RichLanguageFormat.js","../../common/dist/dialogs/index.js","../../common/dist/tools/index.js","../../common/dist/tools/StandardTools.js","../../language-json/dist/index.js","CodeTextArea/CodeTextArea.tsx","ProseMirror/ProseMirror.tsx","ViewSwitcher/ViewSwitcher.tsx","ProseMirrorToolbar/ProseMirrorToolbarContext.ts","ProseMirrorToolbarIconButton/ProseMirrorToolbarIconButton.tsx","ProseMirrorToolbarDropdown/ProseMirrorToolbarDropdown.tsx","ProseMirrorToolbarGroup/ProseMirrorToolbarGroup.tsx","ProseMirrorToolbar/ProseMirrorToolbar.tsx","RichTextEditor/DefaultToolbar.ts","AnchorDialog/AnchorDialog.tsx","CodeDialog/CodeDialog.tsx","HyperlinkDialog/HyperlinkDialog.tsx","ImageDialog/ImageDialog.tsx","RichTextDialogs/RichTextDialogsContext.ts","RichTextDialogs/RichTextDialogsContainer.tsx","RichTextEditor/RichTextEditor.tsx","ProseMirrorToolbar/ProseMirrorToolbarState.ts","EditorRichTextField/EditorRichTextField.tsx","App.tsx","index.tsx","../../common/dist/tools/StandardToolOptions.js","../../language-markdown/dist/alignment/AlignmentTools.js","../../language-markdown/dist/anchor/AnchorNode.js","../../language-markdown/dist/anchor/AnchorTool.js","../../language-markdown/dist/anchor/AnchorToMarkdown.js","../../language-markdown/dist/inline_styles/InlineStylesMark.js","../../language-markdown/dist/utils/MarkUtils.js","../../language-markdown/dist/inline_styles/InlineStylesTool.js","../../language-markdown/dist/inline_styles/InlineStylesToMarkdown.js","../../language-markdown/dist/alignment/RecursiveHtmlBlock.js","../../language-markdown/dist/soft_hyphen/SoftHyphenFromMarkdown.js","../../language-markdown/dist/soft_hyphen/SoftHyphenNode.js","../../language-markdown/dist/soft_hyphen/SoftHyphenToMarkdown.js","../../language-markdown/dist/markdown/MarkdownParser.js","../../language-markdown/dist/alignment/AlignmentPlugin.js","../../language-markdown/dist/tables/TableToMarkdown.js","../../language-markdown/dist/markdown/MarkdownSerializer.js","../../language-markdown/dist/schema/createSchema.js","../../language-markdown/dist/tables/TableTools.js","../../language-markdown/dist/MarkdownLanguage.js","../../language-markdown/dist/soft_hyphen/SoftHyphenTool.js","../../language-markdown/dist/MarkdownLanguageConfiguration.js","../../language-markdown/dist/index.js","../../common/dist/utils/ProseMirrorUtils.js","../../prosemirror-dynamic-content/dist/DcImageLink/DcImageLinkNode.js","../../prosemirror-dynamic-content/dist/InlineChooser/InlineChooser.js","../../prosemirror-dynamic-content/dist/DcImageLink/DcImageLinkView.js","../../prosemirror-dynamic-content/dist/DcContentLink/DcContentLinkNode.js","../../prosemirror-dynamic-content/dist/DcContentLink/DcContentLinkView.js","../../prosemirror-dynamic-content/dist/DynamicContentTools/DynamicContentTools.js","../../language-json/dist/blocks/DcImageLinkBlock.js","../../language-json/dist/blocks/MarkdownBlock.js","../../language-json/dist/schema/createSchema.js","../../language-json/dist/JSONLanguageConfiguration.js","../../language-json/dist/blocks/DcContentLinkBlock.js","../../language-json/dist/JSONLanguage.js","../../common/dist/index.js"],"names":["RichLanguageFormat","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","_a","require","undoFn","undo","redoFn","redo","_b","toggleMark","setBlockType","lift","wrapInList","findParentNode","createMarkToggleTool","name","icon","type","displayIcon","isActive","state","isMarkActive","editLink","dialog","_this","dispatch","view","marks","attrs","linkValue","newAttrs","tr","selection","getSelectionMarks","filter","mark","undefined","cancel","href","title","from","to","addMark","create","removeMark","editCode","params","val","getCurrentParams","insertImage","imageValue","replaceSelectionWith","createAndFill","src","alt","parent","x","node","blockTypeCommand","align","getCurrentAlignment","heading","schema","level","displayLabel","React","createElement","style","margin","nodes","isEnabled","createStandardTools","options","tools","isToolEnabled","Undo","Redo","strong","FormatBold","em","FormatItalic","code","Code","link","Link","empty","dialogs","getHyperlink","FormatIndentDecrease","isVisible","bullet_list","FormatListBulleted","ordered_list","FormatListNumbered","image","ImageIcon","getImage","blockquote","FormatQuote","paragraph","padding","display","code_block","getCode","horizontal_rule","CalendarViewDay","canInsert","FormatClearIcon","clearAllMarks","language","JSONLanguage","conf","JSONLanguageConfiguration","withStyles","root","flex","minHeight","maxHeight","textarea","outline","resize","backgroundColor","border","fontFamily","fontSize","props","classes","onChange","readOnly","handleChange","useCallback","event","target","className","EditorState","EditorView","exampleSetup","tableEditing","columnResizing","keymap","sinkListItem","getKeys","Tab","list_item","ProseMirror","ref","createRef","doc","tablePlugins","table","plugins","menuBar","onUpdateState","editorState","createEditorState","editorViewOptions","dispatchTransaction","transaction","applyTransaction","transactions","meta","contentData","updateState","forceUpdate","some","docChanged","editorView","createEditorView","current","setState","id","Component","width","overflowY","button","transition","height","cursor","background","borderTop","borderBottom","color","fontWeight","selected","borderBottomColor","disableCodeView","disableEditView","useState","CODE","EDIT","selectedView","setSelectedView","renderButton","onClick","clsx","role","ProseMirrorToolbarContext","createContext","toolName","useContext","getToolState","applyTool","toolState","handleClick","focus","document","activeElement","setTimeout","visible","IconButton","onMouseDown","size","disabled","enabled","active","paddingLeft","paddingRight","toolNames","toolStates","map","selectedItems","find","test","renderValue","cloneElement","Select","displayEmpty","preventDefault","MenuItem","key","alignItems","divider","verticalAlign","lineHeight","borderRight","children","layout","toolbarState","renderToolbarElement","element","findIndex","child","tool","toolVisible","Provider","areInlineStyles","keys","clearFormatting","disableGutters","htmlIdRegex","AnchorDialog","open","onClose","onSubmit","existing","Set","setValue","lastValue","setLastValue","validate","checkValue","has","validateId","valid","validError","setValidError","handleInputChanged","fieldValue","newValue","error","reset","handleCancel","handleSubmit","Dialog","maxWidth","fullWidth","aria-labelledby","DialogTitle","DialogContent","FormControl","TextField","autoFocus","required","helperText","FormHelperText","DialogActions","Button","CodeDialog","HyperlinkDialog","isValid","setIsValid","validateUrl","handleClear","ImageDialog","context","RichTextDialogsContainer","openDialog","setOpenDialog","handleCloseDialog","handleSubmitDialog","handleOpenDialog","sdk","SdkContext","getAnchor","getDcImageLink","mediaLink","getDcContentLink","contentTypeIds","contentLink","get","RichTextDialogsContext","frame","flexDirection","borderRadius","languagesProp","languages","languageProp","toolbarLayoutProp","toolbarLayout","disableToolbar","readOnlyCodeView","valueProp","markdown","MarkdownLanguage","Error","languageConfiguration","content","setContent","setView","format","JSON","stringify","rawValue","setRawValue","parse","err","proseMirrorDocument","setProseMirrorDocument","searchMarks","forEach","linkMark","console","log","handleRawValueChange","newProseMirrorDocument","handleEditorChange","types","currentContent","markContent","item","includes","cleanContent","newRawValue","serialize","setToolbarState","DefaultToolbar","handleEditorUpdateState","computeToolbarState","boxSizing","toolOptions","useMemo","settings","useClasses","classOverride","dynamicContent","stagingEnvironment","blacklist","json","nodeViews","getPos","DcImageLinkView","DcContentLinkView","styles","dangerouslySetInnerHTML","__html","stylesheet","rel","toolbar","codeView","App","connected","handleValueChange","bind","handleChooseLink","handleConnect","init","startAutoResizer","field","getValue","withTheme","ReactDOM","render","getElementById","indexOf","whitelist","classNameRegex","getCustomClass","defaultName","name_1","getDefaultClass","customName","classes_1","getContainingTextBlocks","resultNodes","nodesBetween","pos","index","isTextblock","start","depth","add","Array","alignment","setNodeMarkup","alignActive","anyMismatch","alignable","anchor","group","inline","parseDOM","tag","getAttrs","dom","getAttribute","toDOM","insertAnchor","existingAnchors_1","addAnchor_1","$from","$to","anchorValue","delete","AnchorToMarkdown","attrsSerialized","join","write","inline_styles","class","default","attributes","getMarkFromRange","markType","isInSet","mergeAttrs","oldAttrs","inlineStyleClassNameTool","classLabel","$cursor","ranges","storedMarks","existingMark","getStoredMark","removeStoredMark","addStoredMark","ref$1","rangeHasMark","_i","ranges_1","ref$2","$from$1","$to$1","markAttrs","scrollIntoView","found","rangeHasFilteredMark","isFilteredMarkActive","m","InlineStylesToMarkdown","close","HTML_OPEN_CLOSE_TAG_RE","RegExp","HTML_SEQUENCES","source","html_block","startLine","endLine","silent","nextLine","token","lineText","bMarks","tShift","max","eMarks","sCount","blkIndent","md","html","charCodeAt","slice","getLines","DOMParser","parseFromString","firstChild","innerContent","innerHTML","line","tagName","soft_hyphen_from","soft_hyphen","SoftHyphenToMarkdown","markdownit","markdownItTable","createMarkdownParser","use","ruler","before","block","parser","MarkdownParser","defaultMarkdownParser","tokens","tok","attrGet","fence","info","noCloseToken","th","td","tokenHandlers","html_inline","trim","startsWith","endsWith","nodeName","toLowerCase","openMark","closeMark","addNode","hard_break","alignedParagraphTypes","Map","alignmentClasses","html_block_open","styleAttr","attr","alignAttr","ownerElement","textAlign","classAttr","classList","asDefault","nodeType","Number","openNode","html_block_close","closeNode","paragraph_align","getHeadingAttrs","heading_align","defining","TableToMarkdown","rows","childCount","maybeChild","columnCount","closeBlock","table_row","_loop_1","action","out","substr","trimEnd","replace","padEnd","closed","withTableEscapes","renderInline","table_cell","table_header","TextToMarkdown","text","escape","createMarkdownSerializer","MarkdownSerializer","defaultMarkdownSerializer","AlignedParagraphToMarkdown","repeat","AlignedHeaderToMarkdown","serializer","tableNodes","Schema","createSchema","isInlineStylesEnabled","spec","addToEnd","append","tableGroup","cellContent","cellAttributes","getFromDOM","setDOMAttr","update","getDefaultSerializerParser","Fragment","inTable","path","$head","generateEmptyCell","fromArray","insertTable","__spreadArrays","il","r","k","a","j","jl","createMarkdownTools","concat","inlineStylesOptions","classNames","createInlineStylesTools","Directions","AnchorTool","Remove","SoftHyphenTool","FormatAlignLeft","FormatAlignCenter","FormatAlignRight","FormatAlignJustify","TableChart","CreateTableTool","BorderClear","deleteTable","VerticalAlignBottom","addRowAfter","LastPage","addColumnAfter","VerticalAlignTop","deleteRow","FirstPage","deleteColumn","data","TEXT","MarkdownLanguageConfiguration","inBlock","currentMarks","nodeSize","d","canReplaceWith","marks_1","range","_c","markName","DcImageLinkNode","draggable","atom","__rest","getOwnPropertySymbols","propertyIsEnumerable","position","variant","aspectRatio","other","aspectRatioPaddingTop","components","split","Math","round","paddingTop","ViewComponent","loading","broken","invalid","statusIcons","top","left","right","bottom","alignContent","justifyContent","onDelete","setBroken","setLoading","handleLoading","handleError","handleLoaded","hasValidValue","endpoint","Fab","StyledFab","InlineChooser","defaultHost","encodeURIComponent","onLoadStart","onError","onLoad","CircularProgress","BrokenImageIcon","ChooserActions","DeleteIcon","handleDelete","DcContentLinkNode","boxShadow","backgroundSize","backgroundRepeat","backgroundPosition","contentType","contentLinkOptions","isArray","result_1","cards","icons","aspectRatios","setting","card","convertSettings","contentTypeSettings","customIcon","getContentTypeIcon","cardTemplateUrl","getContentTypeCard","schemaId","getContentTypeAspectRatio","backgroundImage","ContentItemIcon","Visualization","template","contentItemId","createDynamicContentTools","ImageSearchIcon","dcImageLink","contentTypes","AddCircleIcon","dcContentLink","AddLocationIcon","err_3","setMeta","dcContentLinkUrl","Node","DcImageLinkBlock","canSerialize","canParse","blocks","MarkdownBlock","ensureInit","parsedNodes","fromJSON","toJSON","createMarkdownSchema","addBefore","DcContentLinkBlock","blockTypes","nodesByConverter","groupBy","blockType","nodesByConverter_1","groupBlocks","items","blocksGroupedByConverter","blocksGroupedByConverter_1","groupFn","currentGroup","currentGroupItems","items_1","itemGroup"],"mappings":"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","file":"static/js/main.e27b6565.chunk.js","sourcesContent":["export * from \"./RichLanguage\";\nexport * from \"./RichLanguageConfiguration\";\nexport * from \"./RichLanguageFormat\";\n","export var RichLanguageFormat;\n(function (RichLanguageFormat) {\n    RichLanguageFormat[\"TEXT\"] = \"text\";\n    RichLanguageFormat[\"JSON\"] = \"json\";\n})(RichLanguageFormat || (RichLanguageFormat = {}));\n","export * from \"./RichTextDialogs\";\n","export * from \"./ProseMirrorTool\";\nexport * from \"./ProseMirrorToolState\";\nexport * from \"./StandardTools\";\nexport * from \"./StandardToolOptions\";\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport React from \"react\";\nimport { canInsert, clearAllMarks, getSelectionMarks, isMarkActive } from \"../utils\";\n// tslint:disable:no-submodule-imports\nimport CalendarViewDay from \"@material-ui/icons/CalendarViewDay\";\nimport Code from \"@material-ui/icons/Code\";\nimport FormatBold from \"@material-ui/icons/FormatBold\";\nimport FormatClearIcon from '@material-ui/icons/FormatClear';\nimport FormatIndentDecrease from \"@material-ui/icons/FormatIndentDecrease\";\nimport FormatItalic from \"@material-ui/icons/FormatItalic\";\nimport FormatListBulleted from \"@material-ui/icons/FormatListBulleted\";\nimport FormatListNumbered from \"@material-ui/icons/FormatListNumbered\";\nimport FormatQuote from \"@material-ui/icons/FormatQuote\";\nimport ImageIcon from \"@material-ui/icons/Image\";\nimport Link from \"@material-ui/icons/Link\";\nimport Redo from \"@material-ui/icons/Redo\";\nimport Undo from \"@material-ui/icons/Undo\";\nimport { isToolEnabled } from \"./StandardToolOptions\";\n// tslint:disable-next-line\nvar _a = require(\"prosemirror-history\"), undoFn = _a.undo, redoFn = _a.redo;\n// tslint:disable-next-line\nvar _b = require(\"prosemirror-commands\"), toggleMark = _b.toggleMark, setBlockType = _b.setBlockType, lift = _b.lift;\n// tslint:disable-next-line\nvar wrapInList = require(\"prosemirror-schema-list\").wrapInList;\n// tslint:disable-next-line\nvar findParentNode = require(\"prosemirror-utils\").findParentNode;\nexport function createMarkToggleTool(name, label, icon, type) {\n    return {\n        name: name,\n        label: label,\n        displayIcon: icon,\n        isActive: function (state) { return isMarkActive(state, type); },\n        apply: toggleMark(type)\n    };\n}\nexport function undo() {\n    return {\n        name: \"undo\",\n        label: \"Undo\",\n        displayIcon: React.createElement(Undo, null),\n        isEnabled: function (state) { return undoFn(state); },\n        apply: undoFn\n    };\n}\nexport function redo() {\n    return {\n        name: \"redo\",\n        label: \"Redo\",\n        displayIcon: React.createElement(Redo, null),\n        isEnabled: function (state) { return redoFn(state); },\n        apply: redoFn\n    };\n}\nexport function strong(schema) {\n    return createMarkToggleTool(\"strong\", \"Bold\", React.createElement(FormatBold, null), schema.marks.strong);\n}\nexport function em(schema) {\n    return createMarkToggleTool(\"em\", \"Italic\", React.createElement(FormatItalic, null), schema.marks.em);\n}\nexport function code(schema) {\n    return createMarkToggleTool(\"code\", \"Code\", React.createElement(Code, null), schema.marks.code);\n}\nexport function editLink(type, dialog) {\n    var _this = this;\n    return function (state, dispatch, view) { return __awaiter(_this, void 0, void 0, function () {\n        var marks, attrs, linkValue, newAttrs, tr, selection, err_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    marks = getSelectionMarks(state).filter(function (mark) { return mark.mark.type === type; });\n                    attrs = marks.length === 1 ? marks[0].mark.attrs : undefined;\n                    if (!dialog) return [3 /*break*/, 4];\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, dialog(attrs)];\n                case 2:\n                    linkValue = _a.sent();\n                    if (linkValue.cancel) {\n                        return [2 /*return*/];\n                    }\n                    newAttrs = {\n                        href: linkValue.href,\n                        title: linkValue.title === \"\" ? undefined : linkValue.title\n                    };\n                    if (marks.length > 0) {\n                        tr = state.tr, selection = state.selection;\n                        if (newAttrs.href !== \"\") {\n                            if (marks.length < 2 && !(selection.from < marks[0].from || selection.to > marks[0].to)) {\n                                dispatch(tr.addMark(marks[0].from, marks[0].to, type.create(newAttrs)));\n                            }\n                            else {\n                                dispatch(tr.addMark(selection.from, selection.to, type.create(newAttrs)));\n                            }\n                        }\n                    }\n                    else {\n                        toggleMark(type, newAttrs)(state, dispatch, view);\n                    }\n                    return [2 /*return*/];\n                case 3:\n                    err_1 = _a.sent();\n                    return [3 /*break*/, 4];\n                case 4:\n                    if (isMarkActive(state, type)) {\n                        dispatch(state.tr.removeMark(marks[0].from, marks[0].to, type));\n                    }\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n}\nexport function editCode(type, dialog) {\n    var _this = this;\n    return function (state, dispatch, view) { return __awaiter(_this, void 0, void 0, function () {\n        var params, val, err_2;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    params = getCurrentParams(state, type);\n                    if (!dialog) return [3 /*break*/, 4];\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, dialog(params.params || \"\")];\n                case 2:\n                    val = _a.sent();\n                    return [2 /*return*/, setBlockType(type, { params: val })(state, dispatch, view)];\n                case 3:\n                    err_2 = _a.sent();\n                    return [3 /*break*/, 4];\n                case 4: return [2 /*return*/];\n            }\n        });\n    }); };\n}\nexport function link(schema, dialog) {\n    return {\n        name: \"link\",\n        label: \"Add or remove Link\",\n        displayIcon: React.createElement(Link, null),\n        isActive: function (state) { return isMarkActive(state, schema.marks.link); },\n        isEnabled: function (state) {\n            return !state.selection.empty || getSelectionMarks(state).filter(function (mark) { return mark.mark.type === schema.marks.link; }).length > 0;\n        },\n        apply: editLink(schema.marks.link, dialog)\n    };\n}\nexport function insertImage(type, dialog) {\n    var _this = this;\n    return function (state, dispatch, view) { return __awaiter(_this, void 0, void 0, function () {\n        var imageValue, err_3;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!dialog) return [3 /*break*/, 4];\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, dialog()];\n                case 2:\n                    imageValue = _a.sent();\n                    view.dispatch(view.state.tr.replaceSelectionWith(type.createAndFill({\n                        src: imageValue.src,\n                        title: imageValue.title === \"\" ? undefined : imageValue.title,\n                        alt: imageValue.alt === \"\" ? undefined : imageValue.alt\n                    })));\n                    return [3 /*break*/, 4];\n                case 3:\n                    err_3 = _a.sent();\n                    return [3 /*break*/, 4];\n                case 4: return [2 /*return*/];\n            }\n        });\n    }); };\n}\nexport function image(schema, dialog) {\n    return {\n        name: \"image\",\n        label: \"Insert Image from URL\",\n        displayIcon: React.createElement(ImageIcon, null),\n        apply: insertImage(schema.nodes.image, dialog)\n    };\n}\nexport function lift_tool(schema) {\n    return {\n        name: \"lift\",\n        label: \"Decrease Indentation\",\n        displayIcon: React.createElement(FormatIndentDecrease, null),\n        isVisible: function (state) { return lift(state); },\n        apply: lift\n    };\n}\nexport function bullet_list(schema) {\n    return {\n        name: \"bullet_list\",\n        label: \"Bullet List\",\n        displayIcon: React.createElement(FormatListBulleted, null),\n        isEnabled: function (state) { return wrapInList(schema.nodes.bullet_list, {})(state); },\n        apply: wrapInList(schema.nodes.bullet_list, {})\n    };\n}\nexport function ordered_list(schema) {\n    return {\n        name: \"ordered_list\",\n        label: \"Ordered List\",\n        displayIcon: React.createElement(FormatListNumbered, null),\n        isEnabled: function (state) { return wrapInList(schema.nodes.ordered_list, {})(state); },\n        apply: wrapInList(schema.nodes.ordered_list, {})\n    };\n}\nexport function blockquote(schema) {\n    return {\n        name: \"blockquote\",\n        label: \"Quote\",\n        displayIcon: React.createElement(FormatQuote, null),\n        isEnabled: function (state) { return wrapInList(schema.nodes.blockquote, {})(state); },\n        apply: wrapInList(schema.nodes.blockquote, {})\n    };\n}\nfunction getCurrentAlignment(state) {\n    if (state == null) {\n        return {};\n    }\n    // Locate the block we're contained in.\n    var parent = findParentNode(function (x) { return x.attrs.align; })(state.selection);\n    if (parent != null) {\n        return { align: parent.node.attrs.align };\n    }\n    else {\n        return {};\n    }\n}\nfunction getCurrentParams(state, type) {\n    if (state == null || type.name !== \"code_block\") {\n        return {};\n    }\n    // Locate the block we're contained in.\n    var parent = findParentNode(function (x) { return x.attrs.params; })(state.selection);\n    if (parent != null) {\n        return { params: parent.node.attrs.params || '' };\n    }\n    else {\n        return { params: '' };\n    }\n}\nfunction blockTypeCommand(state, type, attrs) {\n    return setBlockType(type, __assign(__assign({}, attrs), getCurrentAlignment(state)));\n}\nexport function heading(schema, level) {\n    return {\n        name: \"heading_\" + level,\n        label: \"Heading \" + level,\n        displayLabel: React.createElement(\"h\" + level, { style: { margin: 0 } }, \"Heading \" + level),\n        apply: function (state, dispatch, view) { return blockTypeCommand(state, schema.nodes.heading, { level: level })(state, dispatch, view); },\n        isEnabled: function (state) { return blockTypeCommand(state, schema.nodes.heading, { level: level })(state); },\n        isActive: function (state, view) { return !blockTypeCommand(state, schema.nodes.heading, { level: level })(state, null, view); }\n    };\n}\nexport function paragraph(schema) {\n    var command = setBlockType(schema.nodes.paragraph);\n    return {\n        name: \"paragraph\",\n        label: \"Normal text\",\n        displayLabel: (React.createElement(\"p\", { style: { margin: 0, padding: 0, display: \"inline\" } }, \"Normal text\")),\n        apply: function (state, dispatch, view) { return blockTypeCommand(state, schema.nodes.paragraph)(state, dispatch, view); },\n        isEnabled: function (state) { return blockTypeCommand(state, schema.nodes.paragraph)(state); },\n        isActive: function (state, view) { return !blockTypeCommand(state, schema.nodes.paragraph)(state, null, view); }\n    };\n}\nexport function code_block(schema, dialog) {\n    return {\n        name: \"code_block\",\n        label: \"Code Block\",\n        displayLabel: React.createElement(\"code\", null, \"Code Block\"),\n        displayIcon: React.createElement(Code, null),\n        apply: editCode(schema.nodes.code_block, dialog),\n        isActive: function (state, view) {\n            var params = getCurrentParams(state, schema.nodes.code_block);\n            return !setBlockType(schema.nodes.code_block, __assign({}, params))(state, null, view);\n        }\n    };\n}\nexport function horizontal_rule(schema) {\n    return {\n        name: \"horizontal_rule\",\n        label: \"Insert Horizontal Rule\",\n        displayIcon: React.createElement(CalendarViewDay, null),\n        apply: function (state, dispatch) {\n            dispatch(state.tr.replaceSelectionWith(schema.nodes.horizontal_rule.create()));\n        },\n        isEnabled: function (state) { return canInsert(state, schema.nodes.horizontal_rule); }\n    };\n}\nexport function clear_formatting() {\n    return {\n        name: \"clear_formatting\",\n        label: \"Clear Formatting\",\n        displayIcon: React.createElement(FormatClearIcon, null),\n        apply: clearAllMarks(),\n        isEnabled: function (state) {\n            // are there any marks?\n            return true;\n        }\n    };\n}\nexport function createStandardTools(schema, options) {\n    var tools = [];\n    if (isToolEnabled('undo', options)) {\n        tools.push(undo());\n    }\n    if (isToolEnabled('redo', options)) {\n        tools.push(redo());\n    }\n    if (isToolEnabled('strong', options) && schema.marks.strong) {\n        tools.push(strong(schema));\n    }\n    if (isToolEnabled('em', options) && schema.marks.em) {\n        tools.push(em(schema));\n    }\n    if (isToolEnabled('code', options) && schema.marks.code) {\n        tools.push(code(schema));\n    }\n    if (isToolEnabled('link', options) && schema.marks.link) {\n        tools.push(link(schema, options.dialogs ? options.dialogs.getHyperlink : undefined));\n    }\n    if (isToolEnabled('lift', options)) {\n        tools.push(lift_tool(schema));\n    }\n    if (isToolEnabled('bullet_list', options) && schema.nodes.bullet_list) {\n        tools.push(bullet_list(schema));\n    }\n    if (isToolEnabled('ordered_list', options) && schema.nodes.ordered_list) {\n        tools.push(ordered_list(schema));\n    }\n    if (isToolEnabled('image', options) && schema.nodes.image) {\n        tools.push(image(schema, options.dialogs ? options.dialogs.getImage : undefined));\n    }\n    if (isToolEnabled('blockquote', options) && schema.nodes.blockquote) {\n        tools.push(blockquote(schema));\n    }\n    if (isToolEnabled('heading', options) && schema.nodes.heading) {\n        for (var i = 1; i < 7; i++) {\n            tools.push(heading(schema, i));\n        }\n    }\n    if (isToolEnabled('paragraph', options) && schema.nodes.paragraph) {\n        tools.push(paragraph(schema));\n    }\n    if (isToolEnabled('code_block', options) && schema.nodes.code_block) {\n        tools.push(code_block(schema, options.dialogs ? options.dialogs.getCode : undefined));\n    }\n    if (isToolEnabled('horizontal_rule', options) && schema.nodes.horizontal_rule) {\n        tools.push(horizontal_rule(schema));\n    }\n    if (isToolEnabled('clear_formatting', options)) {\n        tools.push(clear_formatting());\n    }\n    return tools;\n}\n","import JSONLanguage from \"./JSONLanguage\";\nimport JSONLanguageConfiguration from \"./JSONLanguageConfiguration\";\nexport default function (options) {\n    return {\n        language: new JSONLanguage(options),\n        conf: JSONLanguageConfiguration\n    };\n}\nexport * from \"./JSONLanguage\";\nexport * from \"./JSONLanguageConfiguration\";\nexport * from \"./schema/createSchema\";\nexport * from \"./blocks/Block\";\nexport * from \"./blocks/DcImageLinkBlock\";\nexport * from \"./blocks/MarkdownBlock\";\n","import { WithStyles, withStyles } from \"@material-ui/core\";\nimport React, { ChangeEvent } from \"react\";\n\nconst styles = {\n  root: {\n    flex: 1,\n    display: \"flex\",\n    minHeight: 286,\n    maxHeight: 500\n  },\n  textarea: {\n    flex: 1,\n    outline: \"none\" as \"none\",\n    resize: \"none\" as \"none\",\n    backgroundColor: \"#f0f0f0\",\n    border: \"1px solid rgba(157,162,162,.3)\",\n    padding: \"10px 8px 0\",\n    fontFamily: \"roboto,monospace!important\",\n    fontSize: 13\n  }\n};\n\nexport interface CodeTextAreaProps extends WithStyles<typeof styles> {\n  readOnly?: boolean;\n  value: string;\n  onChange?: (value: string) => void;\n}\n\nconst CodeTextArea: React.SFC<CodeTextAreaProps> = (\n  props: CodeTextAreaProps\n) => {\n  const { classes, value, onChange, readOnly = false } = props;\n\n  const handleChange = React.useCallback(\n    (event: ChangeEvent<HTMLTextAreaElement>) => {\n      if (onChange) {\n        onChange(event.target.value);\n      }\n    },\n    [onChange]\n  );\n\n  return (\n    <div className={classes.root}>\n      <textarea\n        readOnly={readOnly}\n        className={classes.textarea}\n        value={value}\n        onChange={handleChange}\n      />\n    </div>\n  );\n};\n\nexport default withStyles(styles)(CodeTextArea);\n","import React, { RefObject, useState } from \"react\";\n\nimport \"./ProseMirror.scss\";\n\nimport { WithStyles, withStyles } from \"@material-ui/core\";\n\n// tslint:disable-next-line\nconst EditorState = require(\"prosemirror-state\").EditorState;\n// tslint:disable-next-line\nconst EditorView = require(\"prosemirror-view\").EditorView;\n// tslint:disable-next-line\nconst exampleSetup = require(\"prosemirror-example-setup\").exampleSetup;\n// tslint:disable-next-line\nconst { tableEditing, columnResizing } = require(\"prosemirror-tables\");\n// tslint:disable-next-line\nconst keymap = require(\"prosemirror-keymap\").keymap;\n// tslint:disable-next-line\nconst { sinkListItem } = require(\"prosemirror-schema-list\");\n\nconst styles = {\n  root: {\n    width: \"100%\",\n    minHeight: 250,\n    maxHeight: 600,\n    overflowY: \"scroll\" as \"scroll\"\n  }\n};\n\nexport interface ProseMirrorProps extends WithStyles<typeof styles> {\n  schema: any;\n  doc?: any;\n  editorViewOptions?: any;\n  onUpdateState?: (state: any, editorView: any) => void;\n  onChange?: (doc: any, types: any) => void;\n}\n\ninterface ProseMirrorState {\n  ref: RefObject<any>;\n  editorView?: any;\n}\n\nfunction getKeys(schema: any): any {\n  return {\n    Tab: sinkListItem(schema.nodes.list_item)\n  }\n}\n\nclass ProseMirror extends React.Component<ProseMirrorProps, ProseMirrorState> {\n  constructor(props: ProseMirrorProps) {\n    super(props);\n    const ref = React.createRef();\n    this.state = { ref };\n  }\n\n  \n  public createEditorState(): any {\n    const { schema, doc } = this.props;\n\n    const withTablePlugins = schema.nodes.table != null;\n    const tablePlugins = withTablePlugins ? [ columnResizing(), tableEditing() ] : [];\n\n    return EditorState.create({\n      schema,\n      doc,\n      plugins: [\n        ...tablePlugins,\n        keymap(getKeys(schema)),\n        ...exampleSetup({ schema, menuBar: false }), // can pass mapkeys to suppress some bindings\n      ]\n    });\n  }\n\n  public createEditorView(parent: any): any {\n    const { onUpdateState, onChange } = this.props;\n\n    const editorState = this.createEditorState();\n\n    const view = new EditorView(parent, {\n      ...this.props.editorViewOptions,\n      state: editorState,\n      dispatchTransaction: (transaction: any) => {\n        const { state, transactions } = view.state.applyTransaction(\n          transaction\n        );\n        if (transaction.meta['content-type']) {\n          if (onUpdateState && onChange) {\n            const contentData = {...transaction.meta}\n            view.updateState(state);\n            onUpdateState(state, view);\n            onChange(state.doc, contentData);\n            this.forceUpdate();\n            return\n          }\n        }\n        view.updateState(state);\n\n        if (onUpdateState) {\n          onUpdateState(state, view);\n        }\n\n        if (transactions.some((tr: any) => tr.docChanged)) {\n          if (onChange) {\n            onChange(state.doc, {});\n          }\n        }\n\n        this.forceUpdate();\n      }\n    });\n\n    if (onUpdateState) {\n      onUpdateState(view.state, view);\n    }\n\n    return view;\n  }\n\n  public componentDidMount(): void {\n    if (this.state.ref && !this.state.editorView) {\n      const editorView = this.createEditorView(this.state.ref.current);\n      this.setState({ editorView });\n    }\n  }\n\n  public render(): React.ReactElement {\n    const { classes } = this.props;\n    return <div id='this' className={classes.root} ref={this.state.ref} />;\n  }\n}\n\nexport default withStyles(styles)(ProseMirror);\n","import { WithStyles, withStyles } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nimport React from \"react\";\n\nconst styles = {\n  root: {\n    display: \"flex\"\n  },\n  button: {\n    outline: \"none\" as \"none\",\n    transition: \"color 0.2s linear,border-bottom-color 0.2s linear\",\n    height: 40,\n    cursor: \"pointer\" as \"pointer\",\n    background: \"transparent\" as \"transparent\",\n    border: \"0 solid transparent\",\n    borderTop: \"3px solid transparent\",\n    borderBottom: \"3px solid transparent\",\n    fontSize: 13,\n    padding: \"0 15px\",\n    color: \"#999999\",\n    fontWeight: \"bold\" as \"bold\"\n  },\n  selected: {\n    color: \"#1EA7FD\",\n    borderBottomColor: \"#1EA7FD\"\n  }\n};\n\nexport interface ViewSwitcherProps extends WithStyles<typeof styles> {\n  disableCodeView?: boolean;\n  disableEditView?: boolean;\n\n  language?: string;\n  onChange?: (view: EditorView) => void;\n}\n\nexport enum EditorView {\n  EDIT = \"edit\",\n  CODE = \"code\"\n}\n\nconst ViewSwitcher = (props: ViewSwitcherProps) => {\n  const {\n    classes,\n    onChange,\n    language,\n    disableCodeView,\n    disableEditView\n  } = props;\n\n  const [selectedView, setSelectedView] = React.useState(\n    !disableEditView ? EditorView.EDIT : EditorView.CODE\n  );\n\n  const handleChange = React.useCallback(\n    (view: EditorView) => {\n      setSelectedView(view);\n      if (onChange) {\n        onChange(view);\n      }\n    },\n    [setSelectedView]\n  );\n\n  const renderButton = React.useCallback(\n    (label: string, view: EditorView) => {\n      return (\n        <button\n          onClick={() => handleChange(view)}\n          className={clsx(classes.button, {\n            [classes.selected]: selectedView === view\n          })}\n          type=\"button\"\n          role=\"tab\"\n        >\n          {label}\n        </button>\n      );\n    },\n    [selectedView, handleChange]\n  );\n\n  return (\n    <div className={classes.root}>\n      {disableEditView ? false : renderButton(\"Edit\", EditorView.EDIT)}\n      {disableCodeView\n        ? false\n        : renderButton(language || \"Code\", EditorView.CODE)}\n    </div>\n  );\n};\n\nexport default withStyles(styles)(ViewSwitcher);\n","import React from \"react\";\n\nimport { ProseMirrorToolState } from \"@dc-extension-rich-text/common\";\n\nexport interface ProseMirrorToolbarContextInterface {\n  getToolState?(toolName: string): ProseMirrorToolState | undefined;\n  applyTool?(toolName: string): void;\n}\n\nconst ProseMirrorToolbarContext = React.createContext<\n  ProseMirrorToolbarContextInterface\n>({});\nexport default ProseMirrorToolbarContext;\n","import { IconButton, withStyles, WithStyles } from \"@material-ui/core\";\nimport React, { PropsWithChildren } from \"react\";\n\nimport { ProseMirrorToolbarContext } from \"../ProseMirrorToolbar\";\n\nimport clsx from \"clsx\";\n\nexport interface ProseMirrorToolbarButtonProps\n  extends PropsWithChildren<WithStyles<typeof styles>> {\n  toolName: string;\n}\n\nconst styles = {\n  root: {\n    margin: \"1px\"\n  }\n};\n\nconst ProseMirrorToolbarIconButton: React.SFC<ProseMirrorToolbarButtonProps> = (\n  props: ProseMirrorToolbarButtonProps\n) => {\n  const { toolName, classes } = props;\n\n  const { getToolState, applyTool } = React.useContext(\n    ProseMirrorToolbarContext\n  );\n\n  const toolState = getToolState ? getToolState(toolName) : null;\n  const handleClick = React.useCallback(event => {\n    const focus = document.activeElement;\n    if (applyTool) {\n      applyTool(toolName);\n    }\n\n    // Focus will switch to the button, which is required to play the ripple effect.\n    // If we return it to the original element as soon as possible, the cursor will be in the same spot.\n    if (focus != null) {\n      setTimeout(() => (focus as HTMLElement).focus(), 0);\n    }\n  }, [toolName, applyTool]);\n\n  if (!toolState || !toolState.visible) {\n    return null;\n  }\n\n  return (\n    <IconButton\n      className={clsx(classes.root)}\n      onMouseDown={handleClick}\n      size=\"small\"\n      disabled={!toolState.enabled}\n      color={toolState.active ? \"primary\" : \"default\"}\n      title={toolState.label}\n    >\n      {toolState.displayIcon ? toolState.displayIcon : toolState.label}\n    </IconButton>\n  );\n};\n\nexport default withStyles(styles)(ProseMirrorToolbarIconButton);\n","import React, { ChangeEvent } from \"react\";\n\nimport { ProseMirrorToolState } from \"@dc-extension-rich-text/common\";\nimport { MenuItem, Select, WithStyles, withStyles } from \"@material-ui/core\";\nimport { ProseMirrorToolbarContext } from \"../ProseMirrorToolbar\";\n\nconst styles = {\n  value: {\n    fontSize: 14,\n    paddingLeft: 6,\n    paddingRight: 6,\n    fontWeight: \"unset\" as \"unset\"\n  }\n};\n\nexport interface ProseMirrorToolbarButtonProps\n  extends WithStyles<typeof styles> {\n  toolNames: string[];\n  label?: string;\n}\n\nconst ProseMirrorToolbarDropdown: React.SFC<ProseMirrorToolbarButtonProps> = (\n  props: ProseMirrorToolbarButtonProps\n) => {\n  const { toolNames, classes, label } = props;\n\n  const { getToolState, applyTool } = React.useContext(\n    ProseMirrorToolbarContext\n  );\n\n  const toolStates = toolNames\n    .map(toolName => {\n      const toolState = getToolState ? getToolState(toolName) : null;\n      return toolState;\n    })\n    .filter(x => x != null) as ProseMirrorToolState[];\n\n  let selectedItems: ProseMirrorToolState[] = toolStates.filter(x => x.active);\n  let selected;\n\n  if (selectedItems && selectedItems.length > 1 ){\n    selected = selectedItems.find(x => /inline_styles/.test(x.name)) || selectedItems[0];\n  } else {\n    selected = selectedItems.find(x => x.active);\n  }\n\n  const value = selected ? selected.name : \"\";\n\n  const handleChange = React.useCallback(\n    (event: ChangeEvent<{ value: unknown }>) => {\n      if (applyTool) {\n        applyTool(event.target.value as string);\n      }\n    },\n    [applyTool]\n  );\n\n  // override renderValue so menu items can be styled\n  const renderValue = React.useCallback(\n    (toolName?: any) => {\n      if (!toolName) {\n        return label || \"\";\n      }\n\n      let toolState:\n        | { label: string; displayLabel?: React.ReactElement }\n        | undefined = getToolState ? getToolState(toolName) : undefined;\n\n      if (!toolState) {\n        toolState = { label: toolName };\n      }\n\n      if (toolState.displayLabel) {\n        return React.cloneElement(toolState.displayLabel, {\n          className: classes.value\n        });\n      }\n      return toolState.label;\n    },\n    [getToolState]\n  );\n\n  if (toolStates.length === 0) {\n    return null;\n  }\n\n  return (\n    <Select\n      value={value}\n      onChange={handleChange}\n      renderValue={renderValue}\n      displayEmpty={true}\n      onMouseDown={(e) => e.preventDefault()}\n    >\n      {toolStates.map(toolState => {\n        return (\n          <MenuItem value={toolState.name} key={toolState.name} onMouseDown={(e) => e.preventDefault()}>\n            {toolState.displayLabel ? (\n              toolState.displayLabel\n            ) : (\n              <span>{toolState.label}</span>\n            )}\n          </MenuItem>\n        );\n      })}\n    </Select>\n  );\n};\n\nexport default withStyles(styles)(ProseMirrorToolbarDropdown);\n","import { WithStyles, withStyles } from \"@material-ui/core\";\nimport React, { PropsWithChildren } from \"react\";\n\nimport clsx from \"clsx\";\n\nconst styles = {\n  root: {\n    display: \"flex\",\n    alignItems: \"center\"\n  },\n  divider: {\n    verticalAlign: \"top\",\n    display: \"inline-flex\",\n    height: 13,\n    lineHeight: 13,\n    borderRight: \"1px solid rgb(218, 220, 224)\",\n    margin: \"9px 4px\"\n  },\n  empty: {\n    display: \"none\"\n  }\n};\n\nexport interface ProseMirrorToolbarGroupProps\n  extends PropsWithChildren<WithStyles<typeof styles>> {}\n\nconst ProseMirrorToolbarGroup: React.SFC<ProseMirrorToolbarGroupProps> = (\n  props: ProseMirrorToolbarGroupProps\n) => {\n  const { children, classes } = props;\n\n  return (\n    <div\n      className={clsx(classes.root, {\n        [classes.empty]: !children\n      })}\n    >\n      {children}\n      <div className={classes.divider} />\n    </div>\n  );\n};\n\nexport default withStyles(styles)(ProseMirrorToolbarGroup);\n","import React from \"react\";\n\nimport {\n  Toolbar as MaterialToolbar,\n  WithStyles,\n  withStyles\n} from \"@material-ui/core\";\n\nimport { ProseMirrorToolbarContext } from \".\";\nimport { ProseMirrorToolbarIconButton } from \"../ProseMirrorToolbarIconButton\";\n\nimport ProseMirrorToolbarDropdown from \"../ProseMirrorToolbarDropdown/ProseMirrorToolbarDropdown\";\nimport { ProseMirrorToolbarGroup } from \"../ProseMirrorToolbarGroup\";\nimport { ProseMirrorToolbarState } from \"./ProseMirrorToolbarState\";\n\nconst styles = {\n  root: {\n    minHeight: 35,\n    borderBottom: \"1px solid rgb(218, 220, 224)\"\n  }\n};\n\nexport interface ToolbarButton {\n  type: \"button\";\n  toolName: string;\n}\n\nexport interface ToolbarDropDown {\n  type: \"dropdown\";\n  label?: string;\n  toolNames: string[];\n}\n\nexport interface ToolbarGroup {\n  type: \"group\";\n  children: ToolbarElement[];\n}\n\nexport type ToolbarElement = ToolbarButton | ToolbarGroup | ToolbarDropDown;\n\nexport interface ProseMirrorToolbarProps extends WithStyles<typeof styles> {\n  toolbarState: ProseMirrorToolbarState | undefined;\n  layout: ToolbarElement[];\n}\n\nconst ProseMirrorToolbar: React.SFC<ProseMirrorToolbarProps> = (\n  props: ProseMirrorToolbarProps\n) => {\n  const { classes, layout, toolbarState } = props;\n\n  const renderToolbarElement = (element: ToolbarElement) => {\n    switch (element.type) {\n      case \"button\":\n        return <ProseMirrorToolbarIconButton toolName={element.toolName}/>;\n      case \"dropdown\":\n        return (\n          <ProseMirrorToolbarDropdown\n            toolNames={element.toolNames}\n            label={element.label}\n          />\n        );\n      case \"group\":\n        const toolVisible = (tool: ToolbarButton): boolean => {\n          const state = toolbarState == null ? null : toolbarState.toolStates[tool.toolName];\n          return state == null ? true : state.visible;\n        };\n\n        const anyVisible = element.children.findIndex(child =>\n          child.type !== \"button\" || toolVisible(child)\n        ) !== -1;\n        return anyVisible ? (\n          <ProseMirrorToolbarGroup>\n            {element.children.map(child => renderToolbarElement(child))}\n          </ProseMirrorToolbarGroup>\n        ) : null;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ProseMirrorToolbarContext.Provider\n      value={{\n        applyTool: (toolName: string) => {\n          if (!toolbarState) {\n            return;\n          }\n\n          const tool = toolbarState.tools.find(x => x.name === toolName);\n          const areInlineStyles = Object.keys(toolbarState.toolStates).filter((x: any) => (/inline_styles/.test(x) && toolbarState.toolStates[x].active));\n          if (!tool) {\n            return;\n          }\n\n          if (areInlineStyles && areInlineStyles.length) {\n            const clearFormatting = toolbarState.tools.find(x => x.name === \"clear_formatting\");\n\n            if (clearFormatting) {\n              clearFormatting.apply(\n                toolbarState.editorView.state,\n                toolbarState.editorView.dispatch,\n                toolbarState.editorView\n              );\n            }\n          }\n\n          tool.apply(\n            toolbarState.editorView.state,\n            toolbarState.editorView.dispatch,\n            toolbarState.editorView\n          );\n        },\n        getToolState: (toolName: string) => {\n          if (!toolbarState) {\n            return undefined;\n          }\n\n          return toolbarState.toolStates[toolName];\n        }\n      }}\n    >\n      <MaterialToolbar className={classes.root} disableGutters={true}>\n        {layout.map(value => {\n          return renderToolbarElement(value);\n        })}\n      </MaterialToolbar>\n    </ProseMirrorToolbarContext.Provider>\n  );\n};\n\nexport default withStyles(styles)(ProseMirrorToolbar);\n","import { ToolbarElement } from \"../ProseMirrorToolbar\";\n\nexport default [\n  {\n    type: \"group\",\n    children: [\n      { type: \"button\", toolName: \"undo\" },\n      { type: \"button\", toolName: \"redo\" }\n    ]\n  },\n\n  {\n    type: \"dropdown\",\n    label: \"Styles\",\n    toolNames: [\n      \"paragraph\",\n      \"heading_1\",\n      \"heading_2\",\n      \"heading_3\",\n      \"heading_4\",\n      \"heading_5\",\n      \"heading_6\",\n      \"code_block\"\n    ]\n  },\n\n  {\n    type: \"group\",\n    children: [\n      { type: \"button\", toolName: \"strong\" },\n      { type: \"button\", toolName: \"em\" },\n      { type: \"button\", toolName: \"soft_hyphen\" },\n      { type: \"button\", toolName: \"link\" },\n      { type: \"button\", toolName: \"anchor\" },\n    ]\n  },\n\n  {\n    type: \"group\",\n    children: [\n      { type: \"button\", toolName: \"align_left\" },\n      { type: \"button\", toolName: \"align_center\" },\n      { type: \"button\", toolName: \"align_right\" },\n      { type: \"button\", toolName: \"align_justify\" }\n    ]\n  },\n\n  {\n    type: \"group\",\n    children: [\n      { type: \"button\", toolName: \"lift\" },\n      { type: \"button\", toolName: \"bullet_list\" },\n      { type: \"button\", toolName: \"ordered_list\" }\n    ]\n  },\n\n  {\n    type: \"group\",\n    children: [\n      { type: \"button\", toolName: \"dc-image-link\" },\n      { type: \"button\", toolName: \"image\" },\n      { type: \"button\", toolName: \"dc-content-link\" },\n      { type: \"button\", toolName: \"blockquote\" },\n      { type: \"button\", toolName: \"code_block\" },\n      { type: \"button\", toolName: \"horizontal_rule\" },\n      { type: \"button\", toolName: \"table_create\" }\n    ]\n  },\n\n  {\n    type: \"group\",\n    children: [\n      { type: \"button\", toolName: \"table_row_add\" },\n      { type: \"button\", toolName: \"table_row_delete\" },\n      { type: \"button\", toolName: \"table_col_add\" },\n      { type: \"button\", toolName: \"table_col_delete\" },\n      { type: \"button\", toolName: \"table_delete\" },\n      { type: \"button\", toolName: \"clear_formatting\" }\n    ]\n  }\n] as ToolbarElement[];\n","import {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  FormControl,\n  FormHelperText,\n  TextField\n} from \"@material-ui/core\";\nimport React from \"react\";\n\nimport { Anchor } from \"@dc-extension-rich-text/common\";\n\ninterface AnchorDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onSubmit: (value: Anchor) => void;\n  value: {\n    existing: Set<string>;\n    value: any;\n  };\n}\n\nconst htmlIdRegex = /^[a-zA-Z][\\w:.\\-]*$/;\n\nfunction validateId(value: string, existing: Set<string>): string | undefined {\n  if (value == null || value.length === 0) {\n    return 'ID cannot be empty.';\n  }\n\n  if (!htmlIdRegex.test(value)) {\n    return 'Invalid ID.';\n  }\n\n  if (existing.has(value)) {\n    return 'ID is already in use.'\n  }\n\n  return undefined;\n}\n\nconst AnchorDialog: React.SFC<AnchorDialogProps> = (\n  props: AnchorDialogProps\n) => {\n  const { open, onClose, onSubmit } = props;\n  const existing = props.value ? props.value.existing : new Set<string>();\n\n  const [value, setValue] = React.useState<Anchor>({\n    value: \"\"\n  });\n\n  const [lastValue, setLastValue] = React.useState<Anchor>();\n\n  if (props.value != null && props.value.value != null && lastValue !== props.value.value) {\n    setValue(props.value.value);\n    setLastValue(props.value.value);\n  }\n\n  const validate = (checkValue: string) => validateId(checkValue, existing);\n\n  const valid = validate(value.value);\n  const [validError, setValidError] = React.useState<string | undefined>(valid);\n  if (valid !== validError) {\n    setValidError(valid);\n  }\n\n  const handleInputChanged = React.useCallback(\n    (name: string, fieldValue: string) => {\n      const newValue = {\n        ...value,\n        [name]: fieldValue\n      };\n\n      setValue(newValue);\n      const error = validate(newValue.value);\n      setValidError(error);\n    },\n    [value, setValue, setValidError]\n  );\n\n  const reset = () => {\n    setValue({\n      value: \"\"\n    });\n  };\n\n  const handleCancel = React.useCallback(() => {\n    reset();\n    onClose();\n  }, [setValue, onClose]);\n\n  const handleSubmit = React.useCallback(() => {\n    reset();\n    onSubmit(value);\n  }, [value, setValue, onSubmit]);\n\n  return (\n    <Dialog\n      maxWidth=\"md\"\n      fullWidth={true}\n      open={open}\n      onClose={onClose}\n      aria-labelledby=\"form-dialog-title\"\n    >\n      <DialogTitle id=\"form-dialog-title\">Anchor</DialogTitle>\n      <DialogContent>\n        <FormControl fullWidth={true}>\n          <TextField\n            error={validError !== undefined}\n            autoFocus={true}\n            id=\"value\"\n            label=\"Anchor ID\"\n            type=\"input\"\n            required={true}\n            fullWidth={true}\n            value={value.value}\n            onChange={event => handleInputChanged(\"value\", event.target.value)}\n            helperText={validError}\n          />\n          <FormHelperText>\n            Example: paragraph-4\n          </FormHelperText>\n        </FormControl>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleCancel} color=\"primary\">\n          Cancel\n        </Button>\n        <Button disabled={validError !== undefined} onClick={handleSubmit} color=\"primary\">\n          Confirm\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default AnchorDialog;\n","import {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  FormControl,\n  FormHelperText,\n  TextField\n} from \"@material-ui/core\";\nimport React from \"react\";\n\ninterface CodeDialogProps {\n  value?: string;\n  open: boolean;\n  onClose: () => void;\n  onSubmit: (value: string) => void;\n}\n\nconst htmlIdRegex = /^[a-zA-Z]?[\\w:.\\-\\/]*$/;\n\nconst validate = (checkValue: string) => !htmlIdRegex.test(checkValue) ? \"Value contains invalid characters\" : \"\";\n\nconst CodeDialog: React.SFC<CodeDialogProps> = (props: CodeDialogProps) => {\n  const { open, onClose, onSubmit } = props;\n\n  const [value, setValue] = React.useState<string>(\"\");\n\n  const [validError, setValidError] = React.useState<string>(\"\");\n\n  const [lastValue, setLastValue] = React.useState<string>();\n\n  if (lastValue !== props.value) {\n    setValue(props.value || \"\");\n    setLastValue(props.value);\n  }\n\n  const handleInputChanged = React.useCallback(\n    val => {\n      setValue(val || \"\");\n\n      const error = validate(val);\n      setValidError(error);\n    },\n    [value, setValue, setValidError]\n  );\n\n  const reset = () => {\n    setValue(\"\");\n  };\n\n  const handleCancel = React.useCallback(() => {\n    reset();\n    onClose();\n  }, [setValue, onClose]);\n\n  const handleSubmit = React.useCallback(() => {\n    reset();\n    onSubmit(value);\n  }, [value, setValue, onSubmit]);\n\n  return (\n    <Dialog\n      maxWidth=\"md\"\n      fullWidth={true}\n      open={open}\n      onClose={onClose}\n      aria-labelledby=\"form-dialog-title\"\n    >\n      <DialogTitle id=\"form-dialog-title\">Code block</DialogTitle>\n      <DialogContent>\n        <FormControl fullWidth={true}>\n          <TextField\n            error={!!validError}\n            helperText={validError}\n            autoFocus={true}\n            id=\"href\"\n            label=\"Language\"\n            type=\"input\"\n            fullWidth={true}\n            value={value}\n            onChange={event => handleInputChanged(event.target.value || \"\")}\n          />\n          <FormHelperText>The language to use for syntax highlighting, e.g. javascript or html</FormHelperText>\n        </FormControl>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleCancel} color=\"primary\">\n          Cancel\n        </Button>\n        <Button disabled={!!validError} onClick={handleSubmit} color=\"primary\">\n          Confirm\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default CodeDialog;","import {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  FormControl,\n  FormHelperText,\n  TextField\n} from \"@material-ui/core\";\nimport React from \"react\";\n\nimport { Hyperlink } from \"@dc-extension-rich-text/common\";\n\ninterface HyperlinkDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onSubmit: (value: Hyperlink) => void;\n  value: any;\n}\n\nfunction validateUrl(value: string): boolean {\n  return value != null && value.length > 0;\n}\n\nconst HyperlinkDialog: React.SFC<HyperlinkDialogProps> = (\n  props: HyperlinkDialogProps\n) => {\n  const { open, onClose, onSubmit } = props;\n\n  const [value, setValue] = React.useState<Hyperlink>({\n    href: \"\",\n    title: \"\"\n  });\n\n  const [lastValue, setLastValue] = React.useState<Hyperlink>();\n\n  if (props.value != null && lastValue !== props.value) {\n    setValue(props.value);\n    setLastValue(props.value);\n  }\n\n  const [isValid, setIsValid] = React.useState(false);\n\n  const handleInputChanged = React.useCallback(\n    (name: string, fieldValue: string) => {\n      const newValue = {\n        ...value,\n        [name]: fieldValue\n      };\n\n      setValue(newValue);\n      setIsValid(validateUrl(newValue.href));\n    },\n    [value, setValue, setIsValid]\n  );\n\n  const reset = () => {\n    setValue({\n      href: \"\",\n      title: \"\"\n    });\n    setLastValue(undefined);\n  };\n\n  const handleCancel = React.useCallback(() => {\n    reset();\n    if (lastValue === undefined) {\n      onClose();\n    } else {\n      onSubmit({...lastValue, cancel: true});\n    }\n  }, [lastValue, setLastValue, onSubmit]);\n\n  const handleClear = React.useCallback(() => {\n    reset();\n    onClose();\n  }, [setValue, onClose]);\n\n  const handleSubmit = React.useCallback(() => {\n    reset();\n    onSubmit(value);\n  }, [value, setValue, onSubmit]);\n\n  return (\n    <Dialog\n      maxWidth=\"md\"\n      fullWidth={true}\n      open={open}\n      onClose={handleCancel}\n      aria-labelledby=\"form-dialog-title\"\n    >\n      <DialogTitle id=\"form-dialog-title\">Hyperlink</DialogTitle>\n      <DialogContent>\n        <FormControl fullWidth={true}>\n          <TextField\n            autoFocus={true}\n            id=\"href\"\n            label=\"Web Address\"\n            type=\"input\"\n            required={true}\n            fullWidth={true}\n            value={value.href}\n            onChange={event => handleInputChanged(\"href\", event.target.value)}\n          />\n          <FormHelperText>\n            Example: https://www.storefront.com/black-friday\n          </FormHelperText>\n        </FormControl>\n\n        <FormControl fullWidth={true}>\n          <TextField\n            id=\"title\"\n            label=\"Title\"\n            type=\"input\"\n            fullWidth={true}\n            value={value.title}\n            onChange={event => handleInputChanged(\"title\", event.target.value)}\n          />\n          <FormHelperText>Example: Black Friday Sale</FormHelperText>\n        </FormControl>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleClear} color=\"primary\">\n          Clear\n        </Button>\n        <Button disabled={!isValid} onClick={handleSubmit} color=\"primary\">\n          Confirm\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default HyperlinkDialog;\n","import {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  FormControl,\n  FormHelperText,\n  TextField\n} from \"@material-ui/core\";\nimport React from \"react\";\n\nimport { Image } from \"@dc-extension-rich-text/common\";\n\ninterface ImageDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onSubmit: (value: Image) => void;\n}\n\nfunction validateUrl(value: string): boolean {\n  return value != null && value.length > 0;\n}\n\nconst ImageDialog: React.SFC<ImageDialogProps> = (props: ImageDialogProps) => {\n  const { open, onClose, onSubmit } = props;\n\n  const [value, setValue] = React.useState<Image>({\n    src: \"\",\n    alt: \"\",\n    title: \"\"\n  });\n\n  const [isValid, setIsValid] = React.useState(false);\n\n  const handleInputChanged = React.useCallback(\n    (name: string, fieldValue: string) => {\n      const newValue = {\n        ...value,\n        [name]: fieldValue\n      };\n\n      setValue(newValue);\n      setIsValid(validateUrl(newValue.src));\n    },\n    [value, setValue, setIsValid]\n  );\n\n  const reset = () => {\n    setValue({\n      src: \"\",\n      alt: \"\",\n      title: \"\"\n    });\n  };\n\n  const handleCancel = React.useCallback(() => {\n    reset();\n    onClose();\n  }, [setValue, onClose]);\n\n  const handleSubmit = React.useCallback(() => {\n    reset();\n    onSubmit(value);\n  }, [value, setValue, onSubmit]);\n\n  return (\n    <Dialog\n      maxWidth=\"md\"\n      fullWidth={true}\n      open={open}\n      onClose={onClose}\n      aria-labelledby=\"form-dialog-title\"\n    >\n      <DialogTitle id=\"form-dialog-title\">Insert Image from URL</DialogTitle>\n      <DialogContent>\n        <FormControl fullWidth={true}>\n          <TextField\n            autoFocus={true}\n            id=\"src\"\n            label=\"Image Address\"\n            type=\"input\"\n            required={true}\n            fullWidth={true}\n            value={value.src}\n            onChange={event => handleInputChanged(\"src\", event.target.value)}\n          />\n          <FormHelperText>\n            Example: https://cdn.storefront.com/image.jpg\n          </FormHelperText>\n        </FormControl>\n\n        <FormControl fullWidth={true}>\n          <TextField\n            id=\"title\"\n            label=\"Image Title\"\n            type=\"input\"\n            fullWidth={true}\n            value={value.title}\n            onChange={event => handleInputChanged(\"title\", event.target.value)}\n          />\n          <FormHelperText>Example: Black Friday Sale</FormHelperText>\n        </FormControl>\n\n        <FormControl fullWidth={true}>\n          <TextField\n            id=\"alt\"\n            label=\"Image Alternative Text\"\n            type=\"input\"\n            fullWidth={true}\n            value={value.alt}\n            onChange={event => handleInputChanged(\"alt\", event.target.value)}\n          />\n          <FormHelperText>Example: Black Friday Sale</FormHelperText>\n        </FormControl>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleCancel} color=\"primary\">\n          Cancel\n        </Button>\n        <Button disabled={!isValid} onClick={handleSubmit} color=\"primary\">\n          Insert\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default ImageDialog;\n","import { RichTextDialogs } from \"@dc-extension-rich-text/common\";\nimport React from \"react\";\n\nexport interface RichTextDialogsContext {\n  dialogs?: RichTextDialogs;\n}\n\nconst context = React.createContext<RichTextDialogsContext>({});\nexport default context;\n","import React, { PropsWithChildren } from \"react\";\n\nimport {\n  Anchor,\n  Hyperlink,\n  Image,\n  RichTextDialogs\n} from \"@dc-extension-rich-text/common\";\nimport { ContentItemLink, MediaImageLink } from \"dc-extensions-sdk\";\nimport AnchorDialog from \"../AnchorDialog/AnchorDialog\";\nimport CodeDialog from \"../CodeDialog/CodeDialog\";\nimport HyperlinkDialog from \"../HyperlinkDialog/HyperlinkDialog\";\nimport ImageDialog from \"../ImageDialog/ImageDialog\";\nimport RichTextDialogsContext from \"./RichTextDialogsContext\";\n\nimport { SdkContext } from \"unofficial-dynamic-content-ui\";\n\ninterface EditorDialogsProps extends PropsWithChildren<{}> {}\n\ninterface OpenDialog {\n  type: string;\n  resolve: (value: any) => void;\n  reject: () => void;\n  value: any;\n}\n\nconst RichTextDialogsContainer: React.SFC<EditorDialogsProps> = (\n  props: EditorDialogsProps\n) => {\n  const { children } = props;\n\n  const [openDialog, setOpenDialog] = React.useState<OpenDialog>();\n\n  const handleCloseDialog = React.useCallback(() => {\n    if (openDialog) {\n      openDialog.reject();\n    }\n    setOpenDialog(undefined);\n  }, [openDialog, setOpenDialog]);\n\n  const handleSubmitDialog = React.useCallback(\n    (value: any) => {\n      if (openDialog) {\n        openDialog.resolve(value);\n      }\n      setOpenDialog(undefined);\n    },\n    [openDialog, setOpenDialog]\n  );\n\n  const handleOpenDialog = React.useCallback(\n    (type: string, value?: any) => {\n      return new Promise((resolve, reject) => {\n        setOpenDialog({\n          type,\n          resolve,\n          reject,\n          value\n        });\n      });\n    },\n    [setOpenDialog]\n  );\n\n  const { sdk } = React.useContext(SdkContext);\n\n  const dialogs: RichTextDialogs = {\n    getAnchor: (existing: Set<string>, value?: Anchor): Promise<Anchor> => {\n      return handleOpenDialog(\"anchor\", { value, existing }) as Promise<Anchor>;\n    },\n    getCode: (value?: string): Promise<string> => {\n      return handleOpenDialog(\"code\", value) as Promise<string>;\n    },\n    getHyperlink: (value?: Hyperlink): Promise<Hyperlink> => {\n      return handleOpenDialog(\"hyperlink\", value) as Promise<Hyperlink>;\n    },\n    getImage: (value?: Image): Promise<Image> => {\n      return handleOpenDialog(\"image\") as Promise<Image>;\n    },\n    getDcImageLink: (value?: MediaImageLink): Promise<MediaImageLink> => {\n      if (!sdk) {\n        return Promise.reject();\n      } else {\n        return sdk.mediaLink.getImage();\n      }\n    },\n    getDcContentLink: (\n      contentTypeIds: string[],\n      value?: ContentItemLink\n    ): Promise<ContentItemLink> => {\n      if (!sdk) {\n        return Promise.reject();\n      } else {\n        return sdk.contentLink.get(contentTypeIds);\n      }\n    }\n  };\n\n  return (\n    <RichTextDialogsContext.Provider value={{ dialogs }}>\n      {children}\n\n      <AnchorDialog\n        value={openDialog != null ? openDialog.value : undefined}\n        open={openDialog != null && openDialog.type === \"anchor\"}\n        onClose={handleCloseDialog}\n        onSubmit={handleSubmitDialog}\n      />\n      <CodeDialog\n        value={openDialog != null ? openDialog.value : undefined}\n        open={openDialog != null && openDialog.type === \"code\"}\n        onClose={handleCloseDialog}\n        onSubmit={handleSubmitDialog}\n      />\n      <HyperlinkDialog\n        value={openDialog != null ? openDialog.value : undefined}\n        open={openDialog != null && openDialog.type === \"hyperlink\"}\n        onClose={handleCloseDialog}\n        onSubmit={handleSubmitDialog}\n      />\n      <ImageDialog\n        open={openDialog != null && openDialog.type === \"image\"}\n        onClose={handleCloseDialog}\n        onSubmit={handleSubmitDialog}\n      />\n    </RichTextDialogsContext.Provider>\n  );\n};\n\nexport default RichTextDialogsContainer;\n","import { WithStyles, withStyles } from \"@material-ui/core\";\nimport React, { ChangeEvent } from \"react\";\nimport CodeTextArea from \"../CodeTextArea/CodeTextArea\";\nimport ProseMirror from \"../ProseMirror/ProseMirror\";\nimport { EditorView, ViewSwitcher } from \"../ViewSwitcher\";\n\nimport {\n  RichLanguage,\n  RichLanguageConfiguration,\n  RichLanguageFormat\n} from \"@dc-extension-rich-text/common\";\nimport MarkdownLanguage from \"@dc-extension-rich-text/language-markdown\";\nimport ProseMirrorToolbar, {\n  ToolbarElement\n} from \"../ProseMirrorToolbar/ProseMirrorToolbar\";\nimport DefaultToolbar from \"./DefaultToolbar\";\n\nimport { computeToolbarState, ProseMirrorToolbarState } from \"../ProseMirrorToolbar/ProseMirrorToolbarState\";\nimport { RichTextDialogsContext } from \"../RichTextDialogs\";\n\nconst styles = {\n  root: {\n    width: \"100%\",\n    height: \"100%\",\n    display: \"flex\"\n  },\n  frame: {\n    flex: 1,\n    display: \"flex\",\n    flexDirection: \"column\" as \"column\",\n    border: \"1px solid rgba(157,162,162,.3)\",\n    borderRadius: 5,\n    padding: \"0 10px 10px 10px\"\n  }\n};\n\ninterface RichTextLanguageMap {\n  [name: string]: { language: RichLanguage; conf: RichLanguageConfiguration };\n}\n\nexport interface RichTextEditorProps extends WithStyles<typeof styles> {\n  languages?: RichTextLanguageMap;\n  language?: string;\n\n  disableToolbar?: boolean;\n  toolbarLayout?: ToolbarElement[];\n\n  disableCodeView?: boolean;\n  readOnlyCodeView?: boolean;\n\n  editorViewOptions?: any;\n\n  value?: any;\n  onChange?: (value: any) => void;\n}\n\nconst RichTextEditor: React.SFC<RichTextEditorProps> = (\n  props: RichTextEditorProps\n) => {\n  const {\n    classes,\n    languages: languagesProp,\n    language: languageProp = \"markdown\",\n    toolbarLayout: toolbarLayoutProp,\n    disableToolbar = false,\n\n    disableCodeView = false,\n    readOnlyCodeView = false,\n\n    editorViewOptions,\n\n    value: valueProp,\n    onChange\n  } = props;\n\n  const { dialogs } = React.useContext(RichTextDialogsContext);\n\n  const languages: RichTextLanguageMap = languagesProp || {\n    markdown: MarkdownLanguage({\n      dialogs\n    })\n  };\n\n  if (!languages[languageProp]) {\n    throw new Error(`Unable to find language ${props.language}`);\n  }\n\n  const { language, conf: languageConfiguration } = languages[languageProp];\n\n  const [content, setContent] = React.useState<any[]>([]);\n  const [view, setView] = React.useState(EditorView.EDIT);\n  const [rawValue, setRawValue] = React.useState(() => {\n    if (!valueProp) {\n      return undefined;\n    }\n    if (valueProp[0].content) {\n      setContent(valueProp[0].content)\n    }\n\n    if (languageConfiguration.format === RichLanguageFormat.JSON) {\n      return JSON.stringify(valueProp, null, 3);\n    } else {\n      return valueProp;\n    }\n  });\n  const [proseMirrorDocument, setProseMirrorDocument] = React.useState(() => {\n    if (!valueProp) {\n      return undefined;\n    }\n\n    try {\n      return language.parse(valueProp);\n      // tslint:disable-next-line\n    } catch (err) {\n    }\n  });\n\n  const cleanContent = (doc: any, content: any) => {\n    if (content.length === 0) return\n    const marks: string[] = [];\n    searchMarks(doc, marks);\n    console.log(marks)\n    const markContent = content.filter((item: any) => marks.includes('id:' + item.id))\n    console.log(content.length)\n    console.log(markContent.length)\n    if (content.length !== markContent.length) {\n      console.log(markContent)\n      console.log('clean')\n      return markContent;\n    }\n    return content;\n  }\n\n  const searchMarks = (doc: any, marks: string[]) => {\n    doc.content.content.forEach((node: any) => {\n      const linkMark = node.marks.find((mark: any) => mark.type.name === 'link')\n      if (linkMark) {\n        console.log('found')\n        marks.push(linkMark.attrs.href)\n      }\n      searchMarks(node, marks);\n    })\n  }\n\n  const handleRawValueChange = React.useCallback(\n    (value: any) => {\n      setRawValue(value);\n\n      if (languageConfiguration.format === RichLanguageFormat.JSON) {\n        try {\n          value = JSON.parse(value);\n        } catch (err) {\n          return;\n        }\n      }\n\n      if (onChange) {\n        onChange(value);\n      }\n\n      try {\n        const newProseMirrorDocument = language.parse(value);\n        setProseMirrorDocument(newProseMirrorDocument);\n        // tslint:disable-next-line\n      } catch (err) {}\n    },\n    [languageConfiguration, setRawValue, setProseMirrorDocument, onChange]\n  );\n\n  const handleEditorChange = React.useCallback(\n    (doc: any, types: any) => {\n      setProseMirrorDocument(doc);\n      try {\n        let currentContent: any[] = content;\n        if (types['content-type']) {\n          currentContent = [...currentContent, JSON.parse(types['content-type'])];\n          setContent(cleanContent(doc, currentContent));\n        }\n        const newRawValue = language.serialize(doc) as any[];\n        if (currentContent.length > 0) {\n          newRawValue[0].content = currentContent;\n        }\n        if (languageConfiguration.format === RichLanguageFormat.JSON) {\n          setRawValue(JSON.stringify(newRawValue, null, 3));\n        } else {\n          setRawValue(newRawValue);\n        }\n        \n        if (onChange) {\n          onChange(newRawValue);\n        }\n        // tslint:disable-next-line\n      } catch (err) {}\n    },\n    [languageConfiguration, setProseMirrorDocument, setRawValue, content]\n  );\n\n  const [toolbarState, setToolbarState] = React.useState<ProseMirrorToolbarState>();\n  const toolbarLayout = toolbarLayoutProp || DefaultToolbar;\n\n  const handleEditorUpdateState = React.useCallback(\n    (state: any, editorView: any) => {\n      setToolbarState(computeToolbarState(language.tools, state, editorView));\n    },\n    [language, setToolbarState]\n  );\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.frame}>\n        <ViewSwitcher\n          onChange={setView}\n          language={language.label}\n          disableCodeView={disableCodeView}\n        />\n        {view === EditorView.EDIT ? (\n          <div>\n            {disableToolbar ? (\n              false\n            ) : (\n              <ProseMirrorToolbar\n                toolbarState={toolbarState}\n                layout={toolbarLayout}\n              />\n            )}\n            <ProseMirror\n              editorViewOptions={editorViewOptions}\n              schema={language.schema}\n              onChange={handleEditorChange}\n              onUpdateState={handleEditorUpdateState}\n              doc={proseMirrorDocument}\n            />\n          </div>\n        ) : (\n          <CodeTextArea\n            value={rawValue}\n            onChange={handleRawValueChange}\n            readOnly={readOnlyCodeView}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default withStyles(styles)(RichTextEditor);\n","import {\n  ProseMirrorTool,\n  ProseMirrorToolState\n} from \"@dc-extension-rich-text/common\";\n\nexport interface ProseMirrorToolbarState {\n  tools: ProseMirrorTool[];\n  toolStates: { [toolName: string]: ProseMirrorToolState };\n  editorView: any;\n}\n\nexport function computeToolbarState(\n  tools: ProseMirrorTool[],\n  editorState: any,\n  editorView: any\n): ProseMirrorToolbarState {\n  const toolStates: { [toolName: string]: ProseMirrorToolState } = {};\n\n  for (const tool of tools) {\n    const state = {\n      active: false,\n      enabled: true,\n      visible: true,\n      ...tool\n    };\n\n    if (tool.isActive) {\n      state.active = tool.isActive(editorState, editorView);\n    }\n\n    if (tool.isVisible) {\n      state.visible = tool.isVisible(editorState, editorView);\n    }\n\n    if (tool.isEnabled) {\n      state.enabled = tool.isEnabled(editorState, editorView);\n    }\n\n    toolStates[tool.name] = state;\n  }\n\n  return {\n    tools,\n    toolStates,\n    editorView\n  };\n}\n","import React from \"react\";\n\nimport { withStyles, WithStyles } from \"@material-ui/core\";\n\nimport { ToolbarElement } from \"../ProseMirrorToolbar\";\nimport { RichTextEditor } from \"../RichTextEditor\";\n\nimport JSONLanguage from \"@dc-extension-rich-text/language-json\";\nimport MarkdownLanguage from \"@dc-extension-rich-text/language-markdown\";\nimport { SdkContext } from \"unofficial-dynamic-content-ui\";\n\nimport {\n  RichLanguage,\n  RichLanguageConfiguration\n} from \"@dc-extension-rich-text/common\";\nimport {\n  DcContentLinkView,\n  DcImageLinkView,\n  DynamicContentToolOptions,\n  ContentTypeExtensionSettings,\n  OldContentTypeExtensionSettings\n} from \"@dc-extension-rich-text/prosemirror-dynamic-content\";\nimport { RichTextDialogsContext } from \"../RichTextDialogs\";\n\nexport const styles = {\n  root: {\n    width: \"100%\"\n  },\n  title: {\n    padding: \"7px 0\",\n    minHeight: \"20px\",\n    color: \"#666\",\n    fontSize: \"13px\",\n    boxSizing: \"border-box\" as \"border-box\",\n    \"-webkit-font-smoothing\": \"auto\",\n    fontFamily: \"roboto,sans-serif!important\"\n  },\n};\n\nexport interface EditorRichTextFieldProps extends WithStyles<typeof styles> {\n  schema: any;\n  value?: any;\n  onChange?: (value: any) => void;\n}\n\nexport interface EditorRichTextFieldParams {\n  title?: string;\n  language?: string;\n\n  styles?: string;\n  stylesheet?: string;\n\n  useClasses?: boolean;\n  classOverride?: { [originalName: string]: string };\n\n  codeView?: {\n    readOnly?: boolean;\n    disabled?: boolean;\n  };\n\n  editView?: {};\n\n  toolbar?: {\n    layout?: ToolbarElement[];\n    disabled?: boolean;\n  };\n\n  tools?: {\n    whitelist?: string[];\n    blacklist?: string[];\n\n    \"dc-content-link\"?: {\n      contentTypes?: string[];\n      contentTypeSettings?:\n        | ContentTypeExtensionSettings[]\n        | OldContentTypeExtensionSettings;\n    };\n  };\n}\n\nconst EditorRichTextField: React.SFC<EditorRichTextFieldProps> = (\n  props: EditorRichTextFieldProps\n) => {\n  const { schema, value: valueProp, onChange, classes } = props;\n\n  const params: EditorRichTextFieldParams =\n    schema && schema[\"ui:extension\"] && schema[\"ui:extension\"].params\n      ? schema[\"ui:extension\"].params\n      : {};\n\n  const { sdk } = React.useContext(SdkContext);\n  const { dialogs } = React.useContext(RichTextDialogsContext);\n\n  const toolOptions = React.useMemo<DynamicContentToolOptions>(() => {\n    const settings = {\n      useClasses: params.useClasses,\n      classOverride: params.classOverride,\n\n      dialogs,\n      dynamicContent: {\n        stagingEnvironment: sdk ? sdk.stagingEnvironment : undefined\n      },\n      tools: params.tools\n    };\n\n    if (settings.tools && !settings.tools.blacklist) {\n      // disable inline_styles by default\n      settings.tools.blacklist = [\"inline_styles\"];\n    }\n\n    return settings;\n  }, [sdk, dialogs, params]);\n\n  const languages = React.useMemo<{\n    [name: string]: { language: RichLanguage; conf: RichLanguageConfiguration };\n  }>(() => {\n    return {\n      markdown: MarkdownLanguage(toolOptions),\n      json: JSONLanguage(toolOptions)\n    };\n  }, []);\n\n  const language = params.language || \"markdown\";\n\n  const editorViewOptions = React.useMemo(() => {\n    return {\n      nodeViews: {\n        \"dc-image-link\": (node: any, view: any, getPos: any) =>\n          new DcImageLinkView(node, view, getPos, toolOptions),\n        \"dc-content-link\": (node: any, view: any, getPos: any) =>\n          new DcContentLinkView(node, view, getPos, toolOptions)\n      },\n    };\n  }, [sdk, toolOptions]);\n\n  return (\n    <div className={classes.root}>\n      {params.styles ? (\n        <style dangerouslySetInnerHTML={{ __html: params.styles }} />\n      ) : (\n        false\n      )}\n      {params.stylesheet ? (\n        <link rel=\"stylesheet\" href={params.stylesheet} />\n      ) : (\n        false\n      )}\n\n      {params.title ? (\n        <div className={classes.title}>{params.title}</div>\n      ) : (\n        false\n      )}\n\n      <RichTextEditor\n        languages={languages}\n        language={params.language}\n        editorViewOptions={editorViewOptions}\n        toolbarLayout={params.toolbar ? params.toolbar.layout : undefined}\n        disableToolbar={params.toolbar ? params.toolbar.disabled : undefined}\n        disableCodeView={params.codeView ? params.codeView.disabled : undefined}\n        readOnlyCodeView={\n          params.codeView ? params.codeView.readOnly : undefined\n        }\n        onChange={onChange}\n        value={valueProp}\n      />\n    </div>\n  );\n};\n\nexport default withStyles(styles)(EditorRichTextField);\n","import React from \"react\";\n\nimport { init, SDK } from \"dc-extensions-sdk\";\nimport { SdkContext, withTheme } from \"unofficial-dynamic-content-ui\";\nimport EditorRichTextField from \"./EditorRichTextField/EditorRichTextField\";\nimport { RichTextDialogsContainer } from \"./RichTextDialogs\";\n\ninterface AppState {\n  connected: boolean;\n  sdk?: SDK;\n  value?: string;\n}\n\nexport default class App extends React.Component<{}, AppState> {\n  constructor(props: {}) {\n    super(props);\n    this.state = { connected: false };\n    this.handleValueChange = this.handleValueChange.bind(this);\n    this.handleChooseLink = this.handleChooseLink.bind(this);\n  }\n\n  public componentDidMount(): void {\n    this.handleConnect();\n  }\n\n  public async handleConnect(): Promise<void> {\n    const sdk: SDK = await init();\n    sdk.frame.startAutoResizer();\n\n    const value: any = await sdk.field.getValue();\n    this.setState({\n      sdk,\n      connected: true,\n      value\n    });\n  }\n\n  public handleValueChange(value: any): void {\n    if (this.state.connected && this.state.sdk) {\n      this.state.sdk.field.setValue(value);\n    }\n  }\n\n  public async handleChooseLink(): Promise<{ href: string; title: string }> {\n    return { href: \"\", title: \"\" };\n  }\n\n  public render(): React.ReactElement {\n    const { connected, value, sdk } = this.state;\n\n    return (\n      <div className=\"App\">\n        {connected && sdk ? (\n          <div>\n            {\n              withTheme(\n                <SdkContext.Provider value={{ sdk }}>\n                <RichTextDialogsContainer>\n                  <EditorRichTextField onChange={this.handleValueChange} value={value} schema={sdk.field.schema} />\n                </RichTextDialogsContainer>\n              </SdkContext.Provider>\n              )\n            }\n          </div>\n        ) : (\n          <div>&nbsp;</div>\n        )}\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"typeface-roboto\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n","export function isToolEnabled(toolName, options) {\n    if (options.tools &&\n        options.tools.blacklist &&\n        options.tools.blacklist.indexOf(toolName) !== -1) {\n        return false;\n    }\n    if (options.tools &&\n        options.tools.whitelist &&\n        options.tools.whitelist.indexOf(toolName) === -1) {\n        return false;\n    }\n    return true;\n}\nvar classNameRegex = /^-?[_a-zA-Z]+[_a-zA-Z0-9-]*$/;\nexport function getCustomClass(defaultName, options) {\n    if (options && options.classOverride) {\n        var name_1 = options.classOverride[defaultName];\n        return (name_1 && classNameRegex.test(name_1)) ? name_1 : defaultName;\n    }\n    return defaultName;\n}\nexport function getDefaultClass(customName, options) {\n    if (options && options.classOverride) {\n        var classes_1 = options.classOverride;\n        var keys = Object.keys(classes_1);\n        return keys.find(function (key) { return classes_1[key] === customName; }) || customName;\n    }\n    return customName;\n}\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { FormatAlignCenter, FormatAlignJustify, FormatAlignLeft, FormatAlignRight } from \"@material-ui/icons\";\nimport React from \"react\";\nfunction getContainingTextBlocks(state) {\n    var resultNodes = new Set();\n    var result = [];\n    state.doc.nodesBetween(state.selection.from, state.selection.to, function (node, pos, parent, index) {\n        if (node.isTextblock && !resultNodes.has(node)) {\n            result.push({ node: node, pos: pos, start: 0, depth: 0 });\n            resultNodes.add(node);\n        }\n    });\n    return Array.from(result);\n}\nfunction align(state, dispatch, alignment) {\n    // Apply align attr to the text block.\n    var result = getContainingTextBlocks(state);\n    var tr = state.tr;\n    result.forEach(function (item) {\n        var node = item.node, pos = item.pos;\n        tr = tr.setNodeMarkup(pos, node.type, __assign(__assign({}, node.attrs), { align: alignment }));\n    });\n    if (dispatch) {\n        dispatch(tr);\n    }\n    return true;\n}\nfunction alignActive(state, view, alignment) {\n    // Apply align attr to the text block.\n    var result = getContainingTextBlocks(state);\n    var anyMismatch = false;\n    result.forEach(function (item) {\n        if ((result[0].node.attrs.align || \"left\") !== alignment) {\n            anyMismatch = true;\n        }\n    });\n    if (result.length === 0) {\n        return false;\n    }\n    return !anyMismatch;\n}\nfunction alignable(state, view) {\n    // Any text block is alignable.\n    return getContainingTextBlocks(state).length > 0;\n}\nexport function AlignLeftTool(schema) {\n    return {\n        name: \"align_left\",\n        label: \"Align Left\",\n        displayIcon: React.createElement(FormatAlignLeft, null),\n        apply: function (state, dispatch) { return align(state, dispatch, \"left\"); },\n        isActive: function (state, view) { return alignActive(state, view, \"left\"); },\n        isVisible: alignable,\n    };\n}\nexport function AlignCenterTool(schema) {\n    return {\n        name: \"align_center\",\n        label: \"Align center\",\n        displayIcon: React.createElement(FormatAlignCenter, null),\n        apply: function (state, dispatch) { return align(state, dispatch, \"center\"); },\n        isActive: function (state, view) { return alignActive(state, view, \"center\"); },\n        isVisible: alignable,\n    };\n}\nexport function AlignRightTool(schema) {\n    return {\n        name: \"align_right\",\n        label: \"Align Right\",\n        displayIcon: React.createElement(FormatAlignRight, null),\n        apply: function (state, dispatch) { return align(state, dispatch, \"right\"); },\n        isActive: function (state, view) { return alignActive(state, view, \"right\"); },\n        isVisible: alignable,\n    };\n}\nexport function AlignJustifyTool(schema) {\n    return {\n        name: \"align_justify\",\n        label: \"Align Justify\",\n        displayIcon: React.createElement(FormatAlignJustify, null),\n        apply: function (state, dispatch) { return align(state, dispatch, \"justify\"); },\n        isActive: function (state, view) { return alignActive(state, view, \"justify\"); },\n        isVisible: alignable,\n    };\n}\n","// tslint:disable-next-line\nexport var anchor = {\n    group: \"inline\",\n    inline: true,\n    attrs: {\n        value: {}\n    },\n    parseDOM: [\n        {\n            tag: \"a[id]\",\n            getAttrs: function (dom) {\n                var value = JSON.parse(dom.getAttribute(\"id\"));\n                return {\n                    value: value\n                };\n            }\n        }\n    ],\n    toDOM: function (node) {\n        var value = node.attrs.value;\n        return [\n            \"a\",\n            { \"id\": JSON.stringify(value) },\n            value\n        ];\n    }\n};\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { canInsert } from \"@dc-extension-rich-text/common\";\nimport Directions from \"@material-ui/icons/Directions\";\nimport React from \"react\";\nexport function AnchorTool(schema, dialog) {\n    return {\n        name: \"anchor\",\n        label: \"Insert Anchor\",\n        displayIcon: React.createElement(Directions, null),\n        apply: insertAnchor(schema.nodes.anchor, dialog),\n        isEnabled: function (state) { return canInsert(state, schema.nodes.anchor); },\n    };\n}\nexport function insertAnchor(type, dialog) {\n    var _this = this;\n    return function (state, dispatch, view) { return __awaiter(_this, void 0, void 0, function () {\n        var existingAnchors_1, addAnchor_1, _a, $from, $to, anchorValue, err_1;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (!dialog) return [3 /*break*/, 4];\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 3, , 4]);\n                    existingAnchors_1 = new Set();\n                    addAnchor_1 = function (node) {\n                        if (node.type.name === 'anchor') {\n                            existingAnchors_1.add(node.attrs.value);\n                        }\n                        else {\n                            node.forEach(addAnchor_1);\n                        }\n                    };\n                    state.doc.forEach(addAnchor_1);\n                    _a = state.selection, $from = _a.$from, $to = _a.$to;\n                    state.doc.nodesBetween($from.pos, $to.pos, function (node, start) {\n                        if (node.type.name === 'anchor') {\n                            existingAnchors_1.delete(node.attrs.value);\n                        }\n                    });\n                    return [4 /*yield*/, dialog(existingAnchors_1)];\n                case 2:\n                    anchorValue = _b.sent();\n                    view.dispatch(view.state.tr.replaceSelectionWith(type.createAndFill({\n                        value: anchorValue.value\n                    })));\n                    return [3 /*break*/, 4];\n                case 3:\n                    err_1 = _b.sent();\n                    return [3 /*break*/, 4];\n                case 4: return [2 /*return*/];\n            }\n        });\n    }); };\n}\n","export var AnchorToMarkdown = {\n    anchor: function (state, node) {\n        var attrs = {};\n        if (node.attrs.value) {\n            attrs.id = node.attrs.value;\n        }\n        var attrsSerialized = Object.keys(attrs)\n            .map(function (key) { return key + \"=\\\"\" + attrs[key] + \"\\\"\"; })\n            .join(\" \");\n        state.write(\"<a \" + attrsSerialized + \"></a>\");\n    },\n};\n","/**\n * Non-standard tool for applying a css class name to a region of the document\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n// tslint:disable-next-line\nexport var inline_styles = {\n    attrs: {\n        class: { default: \"\" },\n        style: { default: \"\" }\n    },\n    group: \"inline\",\n    parseDOM: [\n        {\n            tag: \"span\",\n            getAttrs: function (node) {\n                return {\n                    class: node.getAttribute(\"class\"),\n                    style: (node.attributes.style) ? node.attributes.style.value : undefined\n                };\n            }\n        }\n    ],\n    toDOM: function (mark) {\n        return [\n            \"span\",\n            __assign(__assign({}, (mark.attrs.style ? { style: mark.attrs.style } : {})), { class: mark && mark.attrs && mark.attrs.class ? mark.attrs.class : \"\" }),\n            0\n        ];\n    }\n};\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nfunction rangeHasFilteredMark(doc, from, to, type, filter) {\n    var found = false;\n    if (to > from) {\n        doc.nodesBetween(from, to, function (node) {\n            if (type.isInSet(node.marks) && node.marks.filter(filter).length > 0) {\n                found = true;\n            }\n            return !found;\n        });\n    }\n    return found;\n}\nexport function isFilteredMarkActive(state, type, filter) {\n    var _a = state.selection, from = _a.from, $from = _a.$from, to = _a.to, empty = _a.empty;\n    if (empty) {\n        if (!type.isInSet(state.storedMarks || $from.marks())) {\n            return false;\n        }\n        var validMarks = (state.storedMarks || $from.marks()).filter(filter);\n        return validMarks.length > 0;\n    }\n    else {\n        return rangeHasFilteredMark(state.doc, from, to, type, filter);\n    }\n}\nfunction getMarkFromRange(state, from, to, markType) {\n    var result;\n    if (to > from) {\n        state.doc.nodesBetween(from, to, function (node) {\n            if (markType.isInSet(node.marks)) {\n                result = node.marks.find(function (x) { return x.type === markType; });\n                return false;\n            }\n            return true;\n        });\n    }\n    return result;\n}\nfunction getStoredMark(state, markType) {\n    var ref = state.selection;\n    var $cursor = ref.$cursor;\n    if ($cursor) {\n        return (state.storedMarks || $cursor.marks()).find(function (x) { return x.type === markType; });\n    }\n}\nfunction mergeAttrs(oldAttrs, newAttrs) {\n    return __assign(__assign({}, oldAttrs), newAttrs);\n}\nexport function setMarkAttributes(markType, attrs) {\n    return function (state, dispatch) {\n        var ref = state.selection;\n        var $cursor = ref.$cursor;\n        var ranges = ref.ranges;\n        if (dispatch) {\n            if ($cursor) {\n                if (markType.isInSet(state.storedMarks || $cursor.marks())) {\n                    var existingMark = getStoredMark(state, markType);\n                    dispatch(state.tr.removeStoredMark(markType));\n                    if (existingMark) {\n                        dispatch(state.tr.addStoredMark(markType.create(mergeAttrs(existingMark.attrs, attrs))));\n                    }\n                }\n                else {\n                    dispatch(state.tr.addStoredMark(markType.create(attrs)));\n                }\n            }\n            else {\n                var has = false;\n                var tr = state.tr;\n                for (var i = 0; !has && i < ranges.length; i++) {\n                    var ref$1 = ranges[i];\n                    var $from = ref$1.$from;\n                    var $to = ref$1.$to;\n                    has = state.doc.rangeHasMark($from.pos, $to.pos, markType);\n                }\n                for (var _i = 0, ranges_1 = ranges; _i < ranges_1.length; _i++) {\n                    var ref$2 = ranges_1[_i];\n                    var $from$1 = ref$2.$from;\n                    var $to$1 = ref$2.$to;\n                    if (has) {\n                        var markAttrs = __assign({}, getMarkFromRange(state, $from$1.pos, $to$1.pos, markType).attrs);\n                        tr.removeMark($from$1.pos, $to$1.pos, markType);\n                        tr.addMark($from$1.pos, $to$1.pos, markType.create(mergeAttrs(markAttrs, attrs)));\n                    }\n                    else {\n                        tr.addMark($from$1.pos, $to$1.pos, markType.create(attrs));\n                    }\n                }\n                dispatch(tr.scrollIntoView());\n            }\n        }\n        return true;\n    };\n}\n","import { isToolEnabled } from \"@dc-extension-rich-text/common\";\nimport React from 'react';\nimport { isFilteredMarkActive, setMarkAttributes } from \"../utils/MarkUtils\";\nexport function inlineStyleClassNameTool(schema, className, classLabel) {\n    var mark = schema.marks.inline_styles;\n    return {\n        name: \"inline_styles_className_\" + className,\n        label: classLabel,\n        displayLabel: React.createElement(\"span\", { className: className }, classLabel),\n        apply: setMarkAttributes(mark, { class: className }),\n        isEnabled: function (state) { return true; },\n        isActive: function (state) { return isFilteredMarkActive(state, mark, function (m) { return m.attrs.class === className; }); },\n    };\n}\nexport function createInlineStylesTools(schema, options) {\n    var tools = [];\n    if (schema.marks.inline_styles && isToolEnabled('inline_styles', options) && options.tools && options.tools.inline_styles) {\n        var inlineStylesOptions = options.tools.inline_styles;\n        if (inlineStylesOptions.classNames) {\n            for (var _i = 0, _a = inlineStylesOptions.classNames; _i < _a.length; _i++) {\n                var className = _a[_i];\n                tools.push(inlineStyleClassNameTool(schema, className.className, className.label));\n            }\n        }\n    }\n    return tools;\n}\n","export var InlineStylesToMarkdown = {\n    inline_styles: {\n        open: function (state, mark, parent, index) {\n            var attrs = {};\n            if (mark.attrs.class) {\n                attrs.class = mark.attrs.class;\n            }\n            var attrsSerialized = Object.keys(attrs)\n                .map(function (key) { return key + \"=\\\"\" + attrs[key] + \"\\\"\"; })\n                .join(\" \");\n            if (attrsSerialized.length > 0) {\n                return \"<span \" + attrsSerialized + \">\";\n            }\n            else {\n                return \"<span>\";\n            }\n        },\n        close: \"</span>\"\n    }\n};\n","// HTML block\n'use strict';\nvar blockNames = [\n    'address',\n    'article',\n    'aside',\n    'base',\n    'basefont',\n    'blockquote',\n    'body',\n    'caption',\n    'center',\n    'col',\n    'colgroup',\n    'dd',\n    'details',\n    'dialog',\n    'dir',\n    'div',\n    'dl',\n    'dt',\n    'fieldset',\n    'figcaption',\n    'figure',\n    'footer',\n    'form',\n    'frame',\n    'frameset',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    'head',\n    'header',\n    'hr',\n    'html',\n    'iframe',\n    'legend',\n    'li',\n    'link',\n    'main',\n    'menu',\n    'menuitem',\n    'meta',\n    'nav',\n    'noframes',\n    'ol',\n    'optgroup',\n    'option',\n    'p',\n    'param',\n    'section',\n    'source',\n    'summary',\n    'table',\n    'tbody',\n    'td',\n    'tfoot',\n    'th',\n    'thead',\n    'title',\n    'tr',\n    'track',\n    'ul'\n];\nvar attrName = '[a-zA-Z_:][a-zA-Z0-9:._-]*';\nvar unquoted = '[^\"\\'=<>`\\\\x00-\\\\x20]+';\nvar singleQuoted = \"'[^']*'\";\nvar doubleQuoted = '\"[^\"]*\"';\nvar attrValue = '(?:' + unquoted + '|' + singleQuoted + '|' + doubleQuoted + ')';\nvar attribute = '(?:\\\\s+' + attrName + '(?:\\\\s*=\\\\s*' + attrValue + ')?)';\nvar openTag = '<[A-Za-z][A-Za-z0-9\\\\-]*' + attribute + '*\\\\s*\\\\/?>';\nvar closeTag = '<\\\\/[A-Za-z][A-Za-z0-9\\\\-]*\\\\s*>';\nvar HTML_OPEN_CLOSE_TAG_RE = new RegExp('^(?:' + openTag + '|' + closeTag + ')');\n// An array of opening and corresponding closing sequences for html tags,\n// last argument defines whether it can terminate a paragraph or not\n//\nvar HTML_SEQUENCES = [\n    [/^<(script|pre|style)(?=(\\s|>|$))/i, /<\\/(script|pre|style)>/i, true],\n    [/^<!--/, /-->/, true],\n    [/^<\\?/, /\\?>/, true],\n    [/^<![A-Z]/, />/, true],\n    [/^<!\\[CDATA\\[/, /\\]\\]>/, true],\n    [new RegExp('^</?(' + blockNames.join('|') + ')(?=(\\\\s|/?>|$))', 'i'), /^$/, true],\n    [new RegExp(HTML_OPEN_CLOSE_TAG_RE.source + '\\\\s*$'), /^$/, false]\n];\nexport function html_block(state, startLine, endLine, silent) {\n    var i;\n    var nextLine;\n    var token;\n    var lineText;\n    var pos = state.bMarks[startLine] + state.tShift[startLine];\n    var max = state.eMarks[startLine];\n    // if it's indented more than 3 spaces, it should be a code block\n    if (state.sCount[startLine] - state.blkIndent >= 4) {\n        return false;\n    }\n    if (!state.md.options.html) {\n        return false;\n    }\n    if (state.src.charCodeAt(pos) !== 0x3C /* < */) {\n        return false;\n    }\n    lineText = state.src.slice(pos, max);\n    for (i = 0; i < HTML_SEQUENCES.length; i++) {\n        if (HTML_SEQUENCES[i][0].test(lineText)) {\n            break;\n        }\n    }\n    if (i === HTML_SEQUENCES.length) {\n        return false;\n    }\n    if (silent) {\n        // true if this sequence can be a terminator, false otherwise\n        return HTML_SEQUENCES[i][2];\n    }\n    nextLine = startLine + 1;\n    // If we are here - we detected HTML block.\n    // Let's roll down till block end.\n    if (!HTML_SEQUENCES[i][1].test(lineText)) {\n        for (; nextLine < endLine; nextLine++) {\n            if (state.sCount[nextLine] < state.blkIndent) {\n                break;\n            }\n            pos = state.bMarks[nextLine] + state.tShift[nextLine];\n            max = state.eMarks[nextLine];\n            lineText = state.src.slice(pos, max);\n            if (HTML_SEQUENCES[i][1].test(lineText)) {\n                if (lineText.length !== 0) {\n                    nextLine++;\n                }\n                break;\n            }\n        }\n    }\n    var content = state.getLines(startLine, nextLine, state.blkIndent, true);\n    var dom = new DOMParser().parseFromString(content, \"text/html\");\n    var tag = dom.body.firstChild;\n    var innerContent = (tag == null) ? '' : tag.innerHTML;\n    state.line = nextLine;\n    token = state.push('html_block_open', '', 1);\n    token.meta = { tag: tag.tagName, attrs: Array.from(tag.attributes) };\n    token.map = [startLine, state.line];\n    token = state.push('inline', '', 0);\n    token.map = [startLine, nextLine];\n    token.content = innerContent;\n    token.children = [];\n    token = state.push('html_block_close', '', -1);\n    token.meta = { tag: tag.tagName };\n    return true;\n}\n;\n","// Process &shy;\nexport function soft_hyphen_from(state, silent) {\n    var pos = state.pos;\n    if (state.src.slice(pos, pos + 5) !== \"&shy;\") {\n        return false;\n    }\n    if (!silent) {\n        var content = state.src.slice(pos, pos + 5);\n        var token = state.push('soft_hyphen', 'shy', 0);\n        token.attrs = [];\n        token.content = content;\n    }\n    state.pos = pos + 5;\n    return true;\n}\n;\n","// tslint:disable-next-line\nexport var soft_hyphen = {\n    group: \"inline\",\n    inline: true,\n    parseDOM: [\n        {\n            tag: \"span[data-shy]\",\n            getAttrs: function (dom) {\n                return {};\n            }\n        }\n    ],\n    toDOM: function (node) {\n        return [\n            \"span\",\n            { \"data-shy\": true },\n            \"-\"\n        ];\n    }\n};\n","export var SoftHyphenToMarkdown = {\n    soft_hyphen: function (state, node) {\n        state.write(\"&shy;\");\n    },\n};\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { getDefaultClass } from \"@dc-extension-rich-text/common\";\nimport { html_block } from \"../alignment\";\nimport { soft_hyphen_from } from \"../soft_hyphen\";\n// tslint:disable-next-line\nvar markdown = require(\"prosemirror-markdown\");\n// tslint:disable-next-line\nvar markdownit = require(\"markdown-it\");\n// tslint:disable-next-line\nvar markdownItTable = require('markdown-it-table').markdownItTable;\nexport function createMarkdownParser(schema, options) {\n    var md = markdownit(\"commonmark\", { html: true });\n    md.use(markdownItTable);\n    md.inline.ruler.before(\"text\", \"soft_hyphen\", soft_hyphen_from);\n    md.block.ruler.before(\"html_block\", \"html_block\", html_block);\n    // Patch parser to detect <span></span> tags and convert into inline_styles marks\n    // Warning... this might be a little brittle\n    var parser = new markdown.MarkdownParser(schema, md, __assign(__assign({}, markdown.defaultMarkdownParser.tokens), { anchor: {\n            node: \"anchor\",\n            getAttrs: function (tok) { return ({\n                value: tok.attrGet(\"value\"),\n            }); },\n        }, fence: {\n            block: \"code_block\",\n            getAttrs: function (tok) { return ({ params: tok.info || \"\" }); },\n            noCloseToken: true\n        }, soft_hyphen: { node: \"soft_hyphen\" }, table: { block: \"table\" }, th: { block: \"table_header\", getAttrs: function (tok) { return ({\n                style: tok.attrGet(\"style\"),\n            }); },\n        }, tr: { block: \"table_row\" }, td: { block: \"table_cell\", getAttrs: function (tok) { return ({\n                style: tok.attrGet(\"style\"),\n            }); },\n        } }));\n    parser.tokenHandlers.html_inline = function (state, token) {\n        if (!token || !token.content) {\n            return;\n        }\n        var content = (token.content || \"\").trim();\n        if (content.startsWith(\"<span\") && content.endsWith(\">\")) {\n            var dom = new DOMParser().parseFromString(token.content, \"text/html\");\n            var tag = dom.body.firstChild;\n            if (!tag) {\n                return;\n            }\n            if (tag.nodeName.toLowerCase() === \"span\") {\n                var className = tag.getAttribute(\"class\");\n                state.openMark(schema.marks.inline_styles.create({\n                    class: className\n                }));\n            }\n        }\n        else if (content === \"</span>\") {\n            state.closeMark(schema.marks.inline_styles);\n        }\n        else if (content.startsWith(\"<a\") && content.endsWith(\">\")) {\n            var dom = new DOMParser().parseFromString(token.content, \"text/html\");\n            var tag = dom.body.firstChild;\n            if (!tag) {\n                return;\n            }\n            if (tag.nodeName.toLowerCase() === \"a\") {\n                var id = tag.getAttribute(\"id\");\n                if (id != null) {\n                    state.addNode(schema.nodes.anchor, {\n                        value: id\n                    });\n                }\n            }\n        }\n        else if (content === \"<br>\") {\n            state.addNode(schema.nodes.hard_break);\n        }\n    };\n    var alignedParagraphTypes = new Map([\n        [\"P\", \"paragraph\"],\n        [\"H1\", \"heading\"],\n        [\"H2\", \"heading\"],\n        [\"H3\", \"heading\"],\n        [\"H4\", \"heading\"],\n        [\"H5\", \"heading\"],\n        [\"H6\", \"heading\"],\n    ]);\n    var alignmentClasses = new Map([\n        [\"amp-align-left\", \"left\"],\n        [\"amp-align-center\", \"center\"],\n        [\"amp-align-right\", \"right\"],\n        [\"amp-align-justify\", \"justify\"]\n    ]);\n    // tslint:disable-next-line\n    parser.tokenHandlers.html_block_open = function (state, token) {\n        if (!alignedParagraphTypes.has(token.meta.tag)) {\n            return;\n        }\n        var styleAttr = token.meta.attrs.find(function (attr) { return attr.name === 'style'; });\n        var alignAttr = 'left';\n        if (styleAttr) {\n            alignAttr = styleAttr.ownerElement.style.textAlign || alignAttr;\n        }\n        var classAttr = token.meta.attrs.find(function (attr) { return attr.name === 'class'; });\n        if (classAttr) {\n            // Styles may be present in classes instead\n            classAttr.ownerElement.classList.forEach(function (value) {\n                var asDefault = getDefaultClass(value, options);\n                alignAttr = alignmentClasses.get(asDefault) || 'left';\n            });\n        }\n        var nodeType = alignedParagraphTypes.get(token.meta.tag);\n        var level = (nodeType === 'heading') ? Number(token.meta.tag[1]) : undefined;\n        state.openNode(schema.nodes[nodeType], { align: alignAttr ? alignAttr : 'left', level: level });\n    };\n    // tslint:disable-next-line\n    parser.tokenHandlers.html_block_close = function (state, token) {\n        if (alignedParagraphTypes.has(token.meta.tag)) {\n            state.closeNode();\n        }\n    };\n    return parser;\n}\n","import { getCustomClass } from \"@dc-extension-rich-text/common\";\n// tslint:disable-next-line\nexport var paragraph_align = {\n    content: \"inline*\",\n    attrs: {\n        align: { default: \"left\" }\n    },\n    group: \"block\",\n    parseDOM: [\n        {\n            tag: \"p\",\n            getAttrs: function (dom) {\n                return { align: dom.style.textAlign };\n            }\n        }\n    ],\n    toDOM: function (node) { return [\"p\", { style: \"text-align: \" + (node.attrs.align || \"left\") }, 0]; }\n};\nfunction getHeadingAttrs(level) {\n    return function getAttrs(dom) {\n        return { align: dom.style.textAlign, level: level };\n    };\n}\n// tslint:disable-next-line\nexport var heading_align = {\n    attrs: {\n        level: { default: 1 },\n        align: { default: \"left\" }\n    },\n    content: \"inline*\",\n    group: \"block\",\n    defining: true,\n    parseDOM: [{ tag: \"h1\", getAttrs: getHeadingAttrs(1) },\n        { tag: \"h2\", getAttrs: getHeadingAttrs(2) },\n        { tag: \"h3\", getAttrs: getHeadingAttrs(3) },\n        { tag: \"h4\", getAttrs: getHeadingAttrs(4) },\n        { tag: \"h5\", getAttrs: getHeadingAttrs(5) },\n        { tag: \"h6\", getAttrs: getHeadingAttrs(6) }],\n    toDOM: function (node) { return [\"h\" + node.attrs.level, { style: \"text-align: \" + (node.attrs.align || \"left\") }, 0]; }\n};\nexport var AlignedParagraphToMarkdown = function (options) { return ({\n    paragraph: function (state, node) {\n        if (node.attrs.align && node.attrs.align !== \"left\" && node.attrs.align !== \"start\") {\n            // Aligned paragraph\n            // Emit paragraph as HTML with the align attribute.\n            if (options.useClasses) {\n                state.write(\"<p class=\\\"\" + getCustomClass(\"amp-align-\" + node.attrs.align, options) + \"\\\">\");\n            }\n            else {\n                state.write(\"<p style=\\\"text-align: \" + node.attrs.align + \"\\\">\");\n            }\n            state.renderInline(node);\n            state.write(\"</p>\");\n            state.closeBlock(node);\n        }\n        else {\n            state.renderInline(node);\n            state.closeBlock(node);\n        }\n    },\n}); };\nexport var AlignedHeaderToMarkdown = function (options) { return ({\n    heading: function (state, node) {\n        if (node.attrs.align && node.attrs.align !== \"left\" && node.attrs.align !== \"start\") {\n            // Aligned header\n            // Emit header as HTML with the align attribute.\n            if (options.useClasses) {\n                state.write(\"<h\" + node.attrs.level + \" class=\\\"\" + getCustomClass(\"amp-align-\" + node.attrs.align, options) + \"\\\">\");\n            }\n            else {\n                state.write(\"<h\" + node.attrs.level + \" style=\\\"text-align: \" + node.attrs.align + \"\\\">\");\n            }\n            state.renderInline(node);\n            state.write(\"</h\" + node.attrs.level + \">\");\n            state.closeBlock(node);\n        }\n        else {\n            state.write(state.repeat(\"#\", node.attrs.level) + \" \");\n            state.renderInline(node);\n            state.closeBlock(node);\n        }\n    },\n}); };\n","var defaultRowWidth = 8;\nfunction tableRemoveNewlines(input) {\n    return input.trimEnd().replace(/\\\\?\\n/g, '<br>').padEnd(defaultRowWidth, ' ');\n}\nfunction withTableEscapes(state, action) {\n    var start = state.out.length;\n    action();\n    state.out = state.out.substr(0, start) + tableRemoveNewlines(state.out.substr(start));\n    state.closed = false;\n}\nexport var TableToMarkdown = {\n    table: function (state, node) {\n        var rows = [];\n        for (var i = 0; i < node.childCount; i++) {\n            var child = node.maybeChild(i);\n            if (child != null && child.type.name === 'table_row') {\n                rows.push(child);\n            }\n        }\n        if (rows.length === 0) {\n            return;\n        }\n        // First row is the header row. Get column count, and draw it.\n        state.render(rows[0]);\n        var columnCount = rows[0].childCount; // Assumes first row is header.\n        // Draw divider using the number of columns.\n        state.write('\\n');\n        for (var i = 0; i < columnCount; i++) {\n            state.write('|----------');\n        }\n        state.write('|');\n        // Second row onwards are regular rows.\n        for (var i = 1; i < rows.length; i++) {\n            state.write('\\n');\n            state.render(rows[i]);\n        }\n        state.closeBlock(node);\n    },\n    table_row: function (state, node) {\n        state.write('| ');\n        var _loop_1 = function (i) {\n            var child = node.maybeChild(i);\n            if (child != null) {\n                if (i > 0) {\n                    state.write(' | ');\n                }\n                withTableEscapes(state, function () {\n                    state.renderInline(child);\n                });\n            }\n        };\n        for (var i = 0; i < node.childCount; i++) {\n            _loop_1(i);\n        }\n        state.write(' |');\n    },\n    table_cell: function (state, node) {\n        state.renderInline(node);\n    },\n    table_header: function (state, node) {\n        state.renderInline(node);\n    },\n};\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { AlignedHeaderToMarkdown, AlignedParagraphToMarkdown } from \"../alignment/AlignmentPlugin\";\nimport { AnchorToMarkdown } from \"../anchor\";\nimport { InlineStylesToMarkdown } from \"../inline_styles\";\nimport { SoftHyphenToMarkdown } from \"../soft_hyphen\";\nimport { TableToMarkdown } from \"../tables/TableToMarkdown\";\n// tslint:disable-next-line\nvar markdown = require(\"prosemirror-markdown\");\nfunction escape(text) {\n    return text.replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\");\n}\nvar TextToMarkdown = {\n    text: function (state, node) {\n        state.text(escape(node.text));\n    }\n};\nexport function createMarkdownSerializer(options) {\n    return new markdown.MarkdownSerializer(__assign(__assign(__assign(__assign(__assign(__assign(__assign({}, markdown.defaultMarkdownSerializer.nodes), SoftHyphenToMarkdown), AnchorToMarkdown), TableToMarkdown), AlignedParagraphToMarkdown(options)), AlignedHeaderToMarkdown(options)), TextToMarkdown), __assign(__assign({}, markdown.defaultMarkdownSerializer.marks), InlineStylesToMarkdown));\n}\n","import { heading_align, paragraph_align } from \"../alignment/AlignmentPlugin\";\nimport { anchor } from \"../anchor\";\nimport { inline_styles } from \"../inline_styles\";\nimport { createMarkdownParser } from \"../markdown/MarkdownParser\";\nimport { createMarkdownSerializer } from \"../markdown/MarkdownSerializer\";\nimport { soft_hyphen } from \"../soft_hyphen\";\n// tslint:disable-next-line\nvar tableNodes = require(\"prosemirror-tables\").tableNodes;\n// tslint:disable-next-line\nvar Schema = require(\"prosemirror-model\").Schema;\nexport function createSchema(options, isInlineStylesEnabled) {\n    if (isInlineStylesEnabled === void 0) { isInlineStylesEnabled = false; }\n    var schema = require(\"prosemirror-markdown\").schema;\n    // TODO: don't register nodes and marks that are disabled in the options\n    var marks = schema.spec.marks;\n    if (isInlineStylesEnabled) {\n        marks = marks.addToEnd(\"inline_styles\", inline_styles);\n    }\n    var nodes = schema.spec.nodes.append(tableNodes({\n        tableGroup: \"block\",\n        cellContent: \"block\",\n        cellAttributes: {\n            background: {\n                default: null,\n                // tslint:disable-next-line\n                getFromDOM: function (dom) { return dom.style.backgroundColor || null; },\n                // tslint:disable-next-line\n                setDOMAttr: function (value, attrs) { if (value)\n                    attrs.style = (attrs.style || \"\") + (\"background-color: \" + value + \";\"); }\n            }\n        }\n    })).addToEnd(\"soft_hyphen\", soft_hyphen)\n        .addToEnd(\"anchor\", anchor)\n        .update(\"paragraph\", paragraph_align)\n        .update(\"heading\", heading_align);\n    return new Schema({\n        nodes: nodes,\n        marks: marks\n    });\n}\nvar serializer;\nvar parser;\nexport function getDefaultSerializerParser(schema, options) {\n    if (serializer == null) {\n        serializer = createMarkdownSerializer(options);\n        parser = createMarkdownParser(schema, options);\n    }\n    return [serializer, parser];\n}\n","import { canInsert } from \"@dc-extension-rich-text/common\";\nimport { BorderClear, FirstPage, LastPage, VerticalAlignBottom, VerticalAlignTop } from \"@material-ui/icons\";\nimport TableChart from \"@material-ui/icons/TableChart\";\nimport { addColumnAfter, addRowAfter, deleteColumn, deleteRow, deleteTable, } from \"prosemirror-tables\";\nimport React from \"react\";\n// tslint:disable-next-line: no-var-requires\nvar Fragment = require('prosemirror-model').Fragment;\nfunction inTable(state) {\n    var path = state.selection.$head.path;\n    for (var i = 0; i < path.length; i += 3) {\n        if (path[i].type.name === 'table') {\n            return true;\n        }\n    }\n    return false;\n}\nfunction generateEmptyCell(state, type) {\n    return type.create(undefined, Fragment.fromArray([\n        state.schema.nodes.paragraph.create()\n    ]));\n}\nfunction insertTable(state, dispatch) {\n    var tr = state.tr.replaceSelectionWith(state.schema.nodes.table.create(undefined, Fragment.fromArray([\n        state.schema.nodes.table_row.create(undefined, Fragment.fromArray([\n            generateEmptyCell(state, state.schema.nodes.table_header),\n            generateEmptyCell(state, state.schema.nodes.table_header),\n        ])),\n        state.schema.nodes.table_row.create(undefined, Fragment.fromArray([\n            generateEmptyCell(state, state.schema.nodes.table_cell),\n            generateEmptyCell(state, state.schema.nodes.table_cell),\n        ])),\n    ])));\n    if (dispatch) {\n        dispatch(tr);\n    }\n    return true;\n}\nexport function CreateTableTool(schema) {\n    return {\n        name: \"table_create\",\n        label: \"Create Table\",\n        displayIcon: React.createElement(TableChart, null),\n        apply: insertTable,\n        isEnabled: function (state) { return canInsert(state, schema.nodes.table); },\n        isVisible: function (state) { return !inTable(state); },\n    };\n}\nexport function AddRowTool(schema) {\n    return {\n        name: \"table_row_add\",\n        label: \"Add Row\",\n        displayIcon: React.createElement(VerticalAlignBottom, null),\n        apply: addRowAfter,\n        isVisible: function (state) { return inTable(state); },\n    };\n}\nexport function AddColumnTool(schema) {\n    return {\n        name: \"table_col_add\",\n        label: \"Add Column\",\n        displayIcon: React.createElement(LastPage, null),\n        apply: addColumnAfter,\n        isVisible: function (state) { return inTable(state); },\n    };\n}\nexport function DeleteRowTool(schema) {\n    return {\n        name: \"table_row_delete\",\n        label: \"Delete Row\",\n        displayIcon: React.createElement(VerticalAlignTop, null),\n        apply: deleteRow,\n        isVisible: function (state) { return inTable(state); },\n    };\n}\nexport function DeleteColumnTool(schema) {\n    return {\n        name: \"table_col_delete\",\n        label: \"Delete Column\",\n        displayIcon: React.createElement(FirstPage, null),\n        apply: deleteColumn,\n        isVisible: function (state) { return inTable(state); },\n    };\n}\nexport function DeleteTableTool(schema) {\n    return {\n        name: \"table_delete\",\n        label: \"Delete Table\",\n        displayIcon: React.createElement(BorderClear, null),\n        apply: deleteTable,\n        isVisible: function (state) { return inTable(state); },\n    };\n}\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { createStandardTools, isToolEnabled } from \"@dc-extension-rich-text/common\";\nimport { AlignCenterTool, AlignJustifyTool, AlignLeftTool, AlignRightTool } from \"./alignment/AlignmentTools\";\nimport { AnchorTool } from \"./anchor\";\nimport { createInlineStylesTools } from \"./inline_styles\";\nimport { createMarkdownParser } from \"./markdown/MarkdownParser\";\nimport { createMarkdownSerializer } from \"./markdown/MarkdownSerializer\";\nimport { createSchema } from \"./schema/createSchema\";\nimport { SoftHyphenTool } from \"./soft_hyphen\";\nimport { AddColumnTool, AddRowTool, CreateTableTool, DeleteColumnTool, DeleteRowTool, DeleteTableTool } from \"./tables/TableTools\";\nexport function createMarkdownTools(schema, options) {\n    var tools = [];\n    if (isToolEnabled(\"inline_styles\", options)) {\n        tools = tools.concat(tools, createInlineStylesTools(schema, options));\n    }\n    if (isToolEnabled(\"anchor\", options) && schema.nodes.anchor) {\n        tools.push(AnchorTool(schema, options.dialogs ? options.dialogs.getAnchor : undefined));\n    }\n    if (isToolEnabled(\"soft_hyphen\", options) && schema.nodes.soft_hyphen) {\n        tools.push(SoftHyphenTool(schema));\n    }\n    // Alignment\n    if (isToolEnabled(\"align_left\", options)) {\n        tools.push(AlignLeftTool(schema));\n    }\n    if (isToolEnabled(\"align_center\", options)) {\n        tools.push(AlignCenterTool(schema));\n    }\n    if (isToolEnabled(\"align_right\", options)) {\n        tools.push(AlignRightTool(schema));\n    }\n    if (isToolEnabled(\"align_justify\", options)) {\n        tools.push(AlignJustifyTool(schema));\n    }\n    if (schema.nodes.table) {\n        if (isToolEnabled(\"table_create\", options)) {\n            tools.push(CreateTableTool(schema));\n        }\n        if (isToolEnabled(\"table_delete\", options)) {\n            tools.push(DeleteTableTool(schema));\n        }\n        if (isToolEnabled(\"table_row_add\", options)) {\n            tools.push(AddRowTool(schema));\n        }\n        if (isToolEnabled(\"table_col_add\", options)) {\n            tools.push(AddColumnTool(schema));\n        }\n        if (isToolEnabled(\"table_row_delete\", options)) {\n            tools.push(DeleteRowTool(schema));\n        }\n        if (isToolEnabled(\"table_col_delete\", options)) {\n            tools.push(DeleteColumnTool(schema));\n        }\n    }\n    return tools;\n}\nvar MarkdownLanguage = /** @class */ (function () {\n    function MarkdownLanguage(options) {\n        if (options === void 0) { options = {}; }\n        this.name = \"markdown\";\n        this.label = \"Markdown\";\n        var isInlineStylesEnabled = isToolEnabled(\"inline_styles\", options);\n        var schema = createSchema(options, isInlineStylesEnabled);\n        var tools = __spreadArrays(createStandardTools(schema, options), createMarkdownTools(schema, options));\n        var serializer = createMarkdownSerializer(options);\n        var parser = createMarkdownParser(schema, options);\n        this.schema = schema;\n        this.tools = tools;\n        this.serializer = serializer;\n        this.parser = parser;\n    }\n    MarkdownLanguage.prototype.serialize = function (doc) {\n        return this.serializer.serialize(doc);\n    };\n    MarkdownLanguage.prototype.parse = function (data) {\n        if (!data) {\n            data = \"\";\n        }\n        return this.parser.parse(data);\n    };\n    return MarkdownLanguage;\n}());\nexport default MarkdownLanguage;\n","import { canInsert } from \"@dc-extension-rich-text/common\";\nimport Remove from \"@material-ui/icons/Remove\";\nimport React from \"react\";\nexport function SoftHyphenTool(schema) {\n    return {\n        name: \"soft_hyphen\",\n        label: \"Insert Soft Hyphen\",\n        displayIcon: React.createElement(Remove, null),\n        apply: function (state, dispatch) {\n            dispatch(state.tr.replaceSelectionWith(schema.nodes.soft_hyphen.create()));\n        },\n        isEnabled: function (state) { return canInsert(state, schema.nodes.soft_hyphen); },\n    };\n}\n","import { RichLanguageFormat } from \"@dc-extension-rich-text/common\";\nvar conf = {\n    format: RichLanguageFormat.TEXT\n};\nexport default conf;\n","import MarkdownLanguage from \"./MarkdownLanguage\";\nimport MarkdownLanguageConfiguration from \"./MarkdownLanguageConfiguration\";\nexport default function (options) {\n    return {\n        language: new MarkdownLanguage(options),\n        conf: MarkdownLanguageConfiguration\n    };\n}\nexport * from \"./schema/createSchema\";\nexport { createMarkdownTools } from \"./MarkdownLanguage\";\n","export function inBlock(state) {\n    var $from = state.selection.$from;\n    return $from.depth > 1;\n}\nexport function isMarkActive(state, type) {\n    var _a = state.selection, from = _a.from, $from = _a.$from, to = _a.to, empty = _a.empty;\n    if (empty) {\n        return type.isInSet(state.storedMarks || $from.marks());\n    }\n    else {\n        return state.doc.rangeHasMark(from, to, type);\n    }\n}\nexport function getSelectionMarks(state) {\n    var _a = state.selection, $from = _a.$from, $to = _a.$to;\n    var currentMarks = [];\n    state.doc.nodesBetween($from.pos, $to.pos, function (node, start) {\n        node.marks.forEach(function (mark) { return currentMarks.push({ from: start, to: start + node.nodeSize, mark: mark }); });\n    });\n    return currentMarks;\n}\nexport function hasMarkup(state, type, atts) {\n    var _a = state.selection, $from = _a.$from, to = _a.to, node = _a.node;\n    if (node) {\n        return node.hasMarkup(type, atts);\n    }\n    return to <= $from.end() && $from.parent.hasMarkup(type, atts);\n}\nexport function canInsert(state, type) {\n    var $from = state.selection.$from;\n    for (var d = $from.depth; d >= 0; d--) {\n        var index = $from.index(d);\n        if ($from.node(d).canReplaceWith(index, index, type)) {\n            return true;\n        }\n    }\n    return false;\n}\nexport function clearAllMarks() {\n    return function (state, dispatch) {\n        var ref = state.selection;\n        var $cursor = ref.$cursor;\n        var ranges = ref.ranges;\n        if (dispatch) {\n            if ($cursor) {\n                var marks = state.storedMarks || $cursor.marks();\n                for (var _i = 0, marks_1 = marks; _i < marks_1.length; _i++) {\n                    var mark = marks_1[_i];\n                    dispatch(state.tr.removeStoredMark(mark.type));\n                }\n            }\n            else {\n                var tr = state.tr;\n                for (var _a = 0, ranges_1 = ranges; _a < ranges_1.length; _a++) {\n                    var range = ranges_1[_a];\n                    for (var _b = 0, _c = Object.keys(state.schema.marks); _b < _c.length; _b++) {\n                        var markName = _c[_b];\n                        tr.removeMark(range.$from.pos, range.$to.pos, state.schema.marks[markName]);\n                    }\n                }\n                dispatch(tr);\n            }\n        }\n        return true;\n    };\n}\n","export function DcImageLinkNode() {\n    return {\n        content: \"block\",\n        group: \"block\",\n        defining: true,\n        attrs: {\n            value: {}\n        },\n        nodeSize: 1,\n        draggable: true,\n        atom: true,\n        parseDOM: [\n            {\n                tag: \"dc-image-link[data-dc-image-link]\",\n                getAttrs: function (dom) {\n                    var value = JSON.parse(dom.getAttribute(\"data-dc-image-link\"));\n                    return {\n                        value: value\n                    };\n                }\n            }\n        ],\n        toDOM: function (node) {\n            var value = node.attrs.value;\n            return [\"dc-image-link\", { \"data-dc-image-link\": JSON.stringify(value) }];\n        }\n    };\n}\n","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React from \"react\";\nimport { withStyles } from \"@material-ui/core\";\nimport clsx from \"clsx\";\nvar styles = {\n    root: {\n        display: \"block\",\n        width: \"100%\",\n        minHeight: 150,\n        margin: \"0 10px 10px 0\",\n        position: \"relative\"\n    },\n    content: {},\n    \"empty-slot\": {},\n    \"populated-slot\": {}\n};\nvar InlineChooser = function (props) {\n    var _a;\n    var classes = props.classes, children = props.children, className = props.className, _b = props.variant, variant = _b === void 0 ? \"empty\" : _b, aspectRatio = props.aspectRatio, other = __rest(props, [\"classes\", \"children\", \"className\", \"variant\", \"aspectRatio\"]);\n    var aspectRatioPaddingTop = React.useMemo(function () {\n        if (!aspectRatio) {\n            return undefined;\n        }\n        var components = aspectRatio.split(':');\n        if (components.length !== 2) {\n            return undefined;\n        }\n        return Math.round(Number(components[1]) / Number(components[0]) * 100) + '%';\n    }, [aspectRatio]);\n    return (React.createElement(\"div\", __assign({}, other, { className: clsx(classes.root, (_a = {},\n            _a[classes[\"empty-slot\"]] = variant === \"empty-slot\",\n            _a[classes[\"populated-slot\"]] = variant === \"populated-slot\",\n            _a), className) }), aspectRatio ? (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { style: { display: 'block', paddingTop: aspectRatioPaddingTop } }, \"\\u00A0\"),\n        React.createElement(\"div\", { className: clsx(classes.content) }, children))) : (React.createElement(\"div\", { className: clsx(classes.content) }, children))));\n};\nexport default withStyles(styles)(InlineChooser);\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ChooserActions, DeleteIcon, StyledFab, withTheme } from 'unofficial-dynamic-content-ui';\nimport InlineChooser from '../InlineChooser/InlineChooser';\nimport { CircularProgress, withStyles } from '@material-ui/core';\n// tslint:disable-next-line\nimport BrokenImageIcon from '@material-ui/icons/BrokenImage';\nimport clsx from 'clsx';\nvar styles = {\n    root: {\n        '&$broken, &$invalid': {\n            background: '#e5e5e5'\n        }\n    },\n    image: {\n        maxWidth: '100%'\n    },\n    loading: {},\n    broken: {},\n    invalid: {},\n    statusIcons: {\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        display: 'flex',\n        position: 'absolute',\n        alignItems: 'center',\n        alignContent: 'center',\n        flexDirection: 'row',\n        justifyContent: 'center'\n    }\n};\nvar ViewComponent = withStyles(styles)(function (props) {\n    var _a;\n    var node = props.node, onDelete = props.onDelete, classes = props.classes, options = props.options;\n    var value = node.attrs.value;\n    // BrokenImageIcon\n    var _b = React.useState(false), broken = _b[0], setBroken = _b[1];\n    var _c = React.useState(false), loading = _c[0], setLoading = _c[1];\n    var handleLoading = React.useCallback(function () {\n        setLoading(true);\n    }, [setLoading]);\n    var handleError = React.useCallback(function () {\n        setBroken(true);\n        setLoading(false);\n    }, [setBroken, setLoading]);\n    var handleLoaded = React.useCallback(function () {\n        setBroken(false);\n        setLoading(false);\n    }, [setBroken, setLoading]);\n    var hasValidValue = value && value.endpoint && value.name;\n    //Workaround for ts-jest\n    var Fab = StyledFab;\n    return (React.createElement(\"div\", { className: clsx(classes.root, (_a = {},\n            _a[classes.broken] = broken,\n            _a[classes.loading] = loading,\n            _a[classes.invalid] = !hasValidValue,\n            _a)) },\n        React.createElement(InlineChooser, { variant: \"populated-slot\", aspectRatio: broken || loading || !hasValidValue ? '3:1' : undefined },\n            hasValidValue ?\n                (React.createElement(\"img\", { className: classes.image, src: \"//\" + (options && options.dynamicContent && options.dynamicContent.stagingEnvironment ? options.dynamicContent.stagingEnvironment : value.defaultHost) + \"/i/\" + value.endpoint + \"/\" + encodeURIComponent(value.name), onLoadStart: handleLoading, onError: handleError, onLoad: handleLoaded, alt: \"\" })) : false,\n            React.createElement(\"div\", { className: classes.statusIcons }, loading ?\n                React.createElement(CircularProgress, null) :\n                (broken || !hasValidValue ? React.createElement(BrokenImageIcon, { fontSize: \"large\" }) : false)),\n            React.createElement(ChooserActions, { variant: \"populated-slot\" },\n                React.createElement(Fab, { variant: \"dark\", onClick: onDelete }, DeleteIcon)))));\n});\nvar DcImageLinkView = /** @class */ (function () {\n    function DcImageLinkView(node, view, getPos, options) {\n        if (options === void 0) { options = {}; }\n        this.node = node;\n        this.view = view;\n        this.getPos = getPos;\n        this.options = options;\n        this.dom = document.createElement('div');\n        this.handleDelete = this.handleDelete.bind(this);\n        this.render();\n    }\n    DcImageLinkView.prototype.handleDelete = function () {\n        var start = this.getPos();\n        var tr = this.view.state.tr.delete(start, start + this.node.nodeSize);\n        this.view.dispatch(tr);\n    };\n    DcImageLinkView.prototype.render = function () {\n        ReactDOM.render(withTheme(React.createElement(ViewComponent, { options: this.options, node: this.node, onDelete: this.handleDelete })), this.dom);\n    };\n    return DcImageLinkView;\n}());\nexport { DcImageLinkView };\n","export function DcContentLinkNode() {\n    return {\n        content: \"block\",\n        group: \"block\",\n        defining: true,\n        attrs: {\n            value: {}\n        },\n        nodeSize: 1,\n        draggable: true,\n        atom: true,\n        parseDOM: [\n            {\n                tag: \"dc-content-link[data-dc-content-link]\",\n                getAttrs: function (dom) {\n                    var value = JSON.parse(dom.getAttribute(\"data-dc-content-link\"));\n                    return {\n                        value: value\n                    };\n                }\n            }\n        ],\n        toDOM: function (node) {\n            var value = node.attrs.value;\n            return [\n                \"dc-content-link\",\n                { \"data-dc-content-link\": JSON.stringify(value) }\n            ];\n        }\n    };\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ChooserActions, ContentItem as ContentItemIcon, DeleteIcon, getContentTypeCard, getContentTypeIcon, StyledFab, Visualization, withTheme } from 'unofficial-dynamic-content-ui';\nimport InlineChooser from '../InlineChooser/InlineChooser';\nimport { withStyles } from '@material-ui/core';\nimport clsx from 'clsx';\nvar styles = {\n    root: {\n        '&$broken, &$invalid': {\n            background: '#e5e5e5'\n        },\n        boxShadow: \"0 1px 5px 0 rgba(23,32,44,.2), 0 2px 2px 0 rgba(23,32,44,.1), 0 3px 1px -2px rgba(23,32,44,.1)\"\n    },\n    invalid: {},\n    content: {\n        position: \"absolute\",\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundSize: \"contain\",\n        backgroundRepeat: \"no-repeat\",\n        backgroundPosition: \"50%\"\n    },\n    statusIcons: {\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        display: 'flex',\n        position: 'absolute',\n        alignItems: 'center',\n        alignContent: 'center',\n        flexDirection: 'row',\n        justifyContent: 'center'\n    }\n};\nvar convertSettings = function (settings) {\n    if (settings === undefined) {\n        return undefined;\n    }\n    else if (Array.isArray(settings)) {\n        var result_1 = {\n            cards: {},\n            icons: {},\n            aspectRatios: {}\n        };\n        settings.forEach(function (setting) {\n            if (setting.card) {\n                result_1.cards[setting.id] = setting.card;\n            }\n            if (setting.icon) {\n                result_1.icons[setting.id] = setting.icon;\n            }\n            if (setting.aspectRatio && result_1.aspectRatios) {\n                result_1.aspectRatios[setting.id] = setting.aspectRatio;\n            }\n        });\n        return result_1;\n    }\n    else {\n        return settings;\n    }\n};\nvar ViewComponent = withStyles(styles)(function (props) {\n    var _a;\n    var node = props.node, onDelete = props.onDelete, classes = props.classes, options = props.options;\n    var value = node.attrs.value;\n    var hasValidValue = value && value.id && value.contentType;\n    var contentLinkOptions = options.tools && options.tools[\"dc-content-link\"] ? options.tools[\"dc-content-link\"] : undefined;\n    var settings = contentLinkOptions ? convertSettings(contentLinkOptions.contentTypeSettings) : undefined;\n    var customIcon = settings && hasValidValue ? getContentTypeIcon(settings, value.contentType) : undefined;\n    var cardTemplateUrl = settings && hasValidValue ? getContentTypeCard(settings, value.contentType) : undefined;\n    var aspectRatio = settings && settings.aspectRatios && hasValidValue ? getContentTypeAspectRatio(settings.aspectRatios, value.contentType) : undefined;\n    //Workaround for ts-jest\n    var Fab = StyledFab;\n    return (React.createElement(\"div\", { className: clsx(classes.root, (_a = {}, _a[classes.invalid] = !hasValidValue, _a)) },\n        React.createElement(InlineChooser, { variant: \"populated-slot\", aspectRatio: aspectRatio || '3:1' },\n            React.createElement(\"div\", { className: clsx(classes.content), style: {\n                    backgroundImage: \"url(\" + (customIcon || ContentItemIcon) + \")\"\n                } }, cardTemplateUrl && options && options.dynamicContent && options.dynamicContent.stagingEnvironment ? (React.createElement(Visualization, { template: cardTemplateUrl, params: {\n                    contentItemId: value.id,\n                    stagingEnvironment: options.dynamicContent.stagingEnvironment\n                } })) : (false)),\n            React.createElement(ChooserActions, { variant: \"populated-slot\" },\n                React.createElement(Fab, { variant: \"dark\", onClick: onDelete }, DeleteIcon)))));\n});\nexport function getContentTypeAspectRatio(aspectRatios, schemaId) {\n    for (var _i = 0, _a = Object.keys(aspectRatios); _i < _a.length; _i++) {\n        var key = _a[_i];\n        if (key === \"*\" || key === schemaId) {\n            return aspectRatios[key];\n        }\n    }\n}\nvar DcContentLinkView = /** @class */ (function () {\n    function DcContentLinkView(node, view, getPos, options) {\n        if (options === void 0) { options = {}; }\n        this.node = node;\n        this.view = view;\n        this.getPos = getPos;\n        this.options = options;\n        this.dom = document.createElement('div');\n        this.handleDelete = this.handleDelete.bind(this);\n        this.render();\n    }\n    DcContentLinkView.prototype.handleDelete = function () {\n        var start = this.getPos();\n        var tr = this.view.state.tr.delete(start, start + this.node.nodeSize);\n        this.view.dispatch(tr);\n    };\n    DcContentLinkView.prototype.render = function () {\n        ReactDOM.render(withTheme(React.createElement(ViewComponent, { options: this.options, node: this.node, onDelete: this.handleDelete })), this.dom);\n    };\n    return DcContentLinkView;\n}());\nexport { DcContentLinkView };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport React from 'react';\nimport { isToolEnabled, inBlock, getSelectionMarks } from '@dc-extension-rich-text/common';\n// tslint:disable-next-line\nimport AddCircleIcon from '@material-ui/icons/AddCircle';\n// tslint:disable-next-line\nimport ImageSearchIcon from '@material-ui/icons/ImageSearch';\n// tslint:disable-next-line\nimport AddLocationIcon from '@material-ui/icons/AddLocation';\nvar toggleMark = require(\"prosemirror-commands\").toggleMark;\nexport function dcImageLink(schema, dialog) {\n    var _this = this;\n    var node = schema.nodes['dc-image-link'];\n    return {\n        name: 'dc-image-link',\n        label: 'Insert Image',\n        displayIcon: React.createElement(ImageSearchIcon, null),\n        isEnabled: function (state) { return !inBlock(state); },\n        apply: function (state, dispatch, view) { return __awaiter(_this, void 0, void 0, function () {\n            var value, err_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!dialog) {\n                            return [2 /*return*/];\n                        }\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, dialog()];\n                    case 2:\n                        value = _a.sent();\n                        view.dispatch(view.state.tr.replaceSelectionWith(node.createAndFill({\n                            value: value\n                        })));\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_1 = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); }\n    };\n}\nexport function dcContentLink(schema, contentTypes, dialog) {\n    var _this = this;\n    var node = schema.nodes['dc-content-link'];\n    return {\n        name: 'dc-content-link',\n        label: 'Insert Content',\n        displayIcon: React.createElement(AddCircleIcon, null),\n        isEnabled: function (state) { return !inBlock(state); },\n        apply: function (state, dispatch, view) { return __awaiter(_this, void 0, void 0, function () {\n            var value, err_2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!dialog) {\n                            return [2 /*return*/];\n                        }\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, dialog(contentTypes)];\n                    case 2:\n                        value = _a.sent();\n                        view.dispatch(view.state.tr.replaceSelectionWith(node.createAndFill({\n                            value: value\n                        })));\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_2 = _a.sent();\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); }\n    };\n}\nexport function dcContentLinkUrl(schema, contentTypes, dialog) {\n    var _this = this;\n    var node = schema.nodes['dc-content-link-url'];\n    return {\n        name: 'dc-content-link-url',\n        label: 'Insert link url',\n        displayIcon: React.createElement(AddLocationIcon, null),\n        isEnabled: function (state) {\n            return !state.selection.empty || getSelectionMarks(state).filter(function (mark) { return mark.mark.type === schema.marks.link; }).length > 0;\n        },\n        apply: function (state, dispatch, view) { return __awaiter(_this, void 0, void 0, function () {\n            var marks, value, content, newAttrs, err_3;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!dialog) {\n                            return [2 /*return*/];\n                        }\n                        marks = getSelectionMarks(state);\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, , 4]);\n                        return [4 /*yield*/, dialog(contentTypes)];\n                    case 2:\n                        value = _a.sent();\n                        content = view.state.selection.content();\n                        newAttrs = {\n                            href: 'id:' + value.id,\n                            title: undefined\n                        };\n                        if (content.content.content.length > 0) {\n                            toggleMark(schema.marks.link, newAttrs)(state, dispatch, view);\n                        }\n                        view.dispatch(view.state.tr.setMeta('content-type', JSON.stringify(value)));\n                        return [3 /*break*/, 4];\n                    case 3:\n                        err_3 = _a.sent();\n                        console.log(err_3);\n                        return [3 /*break*/, 4];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); }\n    };\n}\n// export function dcContentLinkUrl(schema: any, contentTypes: string[], dialog?: (contentTypeIds: string[], value?: ContentItemLink) => Promise<ContentItemLink>): ProseMirrorTool {\n//     const node = schema.nodes['dc-content-link-url'];\n//     return {\n//         name: 'dc-content-link-url',\n//         label: 'Insert link url',\n//         displayIcon: <AddLocationIcon />,\n//         isEnabled: (state: any) => {\n//             return !state.selection.empty || getSelectionMarks(state).filter(mark => mark.mark.type === schema.marks.link).length > 0;\n//           },\n//         apply: async (state: any, dispatch: any, view: any) => {\n//             if (!dialog) {\n//                 return;\n//             }\n//             try {\n//                 const value = await dialog(contentTypes);\n//                 console.log(view)\n//                 console.log(view.state.selection.content())\n//                 const content = view.state.selection.content()\n//                 console.log(content.content.content)\n//                 if (content.content.content.length > 0) {\n//                     view.dispatch(view.state.tr.insertText(`[${content.content.content[0].content}](${JSON.stringify(value)})`));\n//                 }\n//                 console.log('value', JSON.stringify(value))\n//                 view.dispatch(view.state.tr.setMeta('content-type', JSON.stringify(value)));\n//                 console.log(view.state.tr.getMeta('content-type'))\n//             // tslint:disable-next-line\n//             } catch (err) {\n//                 console.log(err)\n//             }\n//         }\n//     };\n// }\nexport function createDynamicContentTools(schema, options) {\n    var tools = [];\n    if (isToolEnabled('dc-image-link', options) && schema.nodes['dc-image-link']) {\n        tools.push(dcImageLink(schema, options.dialogs ? options.dialogs.getDcImageLink : undefined));\n    }\n    if (isToolEnabled('dc-content-link', options) &&\n        schema.nodes['dc-content-link'] &&\n        // must provide a list of content types for this tool to be active\n        options.tools && options.tools[\"dc-content-link\"] && options.tools[\"dc-content-link\"].contentTypes && options.tools[\"dc-content-link\"].contentTypes) {\n        tools.push(dcContentLink(schema, options.tools[\"dc-content-link\"].contentTypes, options.dialogs ? options.dialogs.getDcContentLink : undefined));\n    }\n    if (options.tools && options.tools[\"dc-content-link-url\"] && options.tools[\"dc-content-link-url\"].contentTypes) {\n        tools.push(dcContentLinkUrl(schema, options.tools[\"dc-content-link-url\"].contentTypes, options.dialogs ? options.dialogs.getDcContentLink : undefined));\n    }\n    return tools;\n}\n","// tslint:disable-next-line\nvar markdown = require(\"prosemirror-markdown\");\n// tslint:disable-next-line\nvar Node = require(\"prosemirror-model\").Node;\nvar DcImageLinkBlock = /** @class */ (function () {\n    function DcImageLinkBlock() {\n    }\n    DcImageLinkBlock.prototype.canSerialize = function (schema, node) {\n        return node.type === \"dc-image-link\";\n    };\n    DcImageLinkBlock.prototype.serialize = function (schema, nodes) {\n        return nodes.map(function (node) {\n            return {\n                type: \"dc-image-link\",\n                data: node.attrs.value\n            };\n        });\n    };\n    DcImageLinkBlock.prototype.canParse = function (schema, block) {\n        return block.type === \"dc-image-link\";\n    };\n    DcImageLinkBlock.prototype.parse = function (schema, blocks) {\n        var result = [];\n        blocks.forEach(function (block) {\n            result.push({\n                type: \"dc-image-link\",\n                attrs: {\n                    value: block.data\n                }\n            });\n        });\n        return result;\n    };\n    return DcImageLinkBlock;\n}());\nexport default DcImageLinkBlock;\n","import { getDefaultSerializerParser } from '@dc-extension-rich-text/language-markdown';\n// tslint:disable-next-line\nvar markdown = require(\"prosemirror-markdown\");\n// tslint:disable-next-line\nvar Node = require(\"prosemirror-model\").Node;\nvar MarkdownBlock = /** @class */ (function () {\n    function MarkdownBlock(options) {\n        this.options = options;\n    }\n    MarkdownBlock.prototype.canSerialize = function (schema, node) {\n        this.ensureInit(schema);\n        if (!node.type) {\n            return false;\n        }\n        else {\n            return this.serializer.nodes[node.type] != null;\n        }\n    };\n    MarkdownBlock.prototype.serialize = function (schema, nodes) {\n        this.ensureInit(schema);\n        var parsedNodes = Node.fromJSON(schema, {\n            type: \"doc\",\n            content: nodes\n        });\n        return [\n            {\n                type: \"markdown\",\n                data: this.serializer.serialize(parsedNodes)\n            }\n        ];\n    };\n    MarkdownBlock.prototype.canParse = function (schema, block) {\n        return block.type === \"markdown\";\n    };\n    MarkdownBlock.prototype.parse = function (schema, blocks) {\n        var _this = this;\n        this.ensureInit(schema);\n        var result = [];\n        blocks.forEach(function (block) {\n            var doc = _this.parser.parse(block.data || '').toJSON();\n            result = result.concat.apply(result, doc.content || []);\n        });\n        return result;\n    };\n    MarkdownBlock.prototype.ensureInit = function (schema) {\n        var _a;\n        _a = getDefaultSerializerParser(schema, this.options), this.serializer = _a[0], this.parser = _a[1];\n    };\n    return MarkdownBlock;\n}());\nexport default MarkdownBlock;\n","import { createSchema as createMarkdownSchema } from \"@dc-extension-rich-text/language-markdown\";\nimport { DcContentLinkNode, DcImageLinkNode } from \"@dc-extension-rich-text/prosemirror-dynamic-content\";\n// tslint:disable-next-line\nvar Schema = require(\"prosemirror-model\").Schema;\nexport function createSchema(options, isInlineStylesEnabled) {\n    var schema = createMarkdownSchema(options, isInlineStylesEnabled);\n    return new Schema({\n        nodes: schema.spec.nodes\n            .addBefore(\"image\", \"dc-image-link\", DcImageLinkNode())\n            .addBefore(\"image\", \"dc-content-link\", DcContentLinkNode()),\n        marks: schema.spec.marks\n    });\n}\n","import { RichLanguageFormat } from \"@dc-extension-rich-text/common\";\nvar conf = {\n    format: RichLanguageFormat.JSON\n};\nexport default conf;\n","// tslint:disable-next-line\nvar markdown = require(\"prosemirror-markdown\");\n// tslint:disable-next-line\nvar Node = require(\"prosemirror-model\").Node;\nvar DcContentLinkBlock = /** @class */ (function () {\n    function DcContentLinkBlock() {\n    }\n    DcContentLinkBlock.prototype.canSerialize = function (schema, node) {\n        return node.type === \"dc-content-link\";\n    };\n    DcContentLinkBlock.prototype.serialize = function (schema, nodes) {\n        return nodes.map(function (node) {\n            return {\n                type: \"dc-content-link\",\n                data: node.attrs.value\n            };\n        });\n    };\n    DcContentLinkBlock.prototype.canParse = function (schema, block) {\n        return block.type === \"dc-content-link\";\n    };\n    DcContentLinkBlock.prototype.parse = function (schema, blocks) {\n        var result = [];\n        blocks.forEach(function (block) {\n            result.push({\n                type: \"dc-content-link\",\n                attrs: {\n                    value: block.data\n                }\n            });\n        });\n        return result;\n    };\n    return DcContentLinkBlock;\n}());\nexport default DcContentLinkBlock;\n","var __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { createStandardTools, isToolEnabled } from \"@dc-extension-rich-text/common\";\nimport { createMarkdownTools } from \"@dc-extension-rich-text/language-markdown\";\nimport { createDynamicContentTools } from \"@dc-extension-rich-text/prosemirror-dynamic-content\";\nimport DcContentLinkBlock from \"./blocks/DcContentLinkBlock\";\nimport DcImageLinkBlock from \"./blocks/DcImageLinkBlock\";\nimport MarkdownBlock from \"./blocks/MarkdownBlock\";\nimport { createSchema } from \"./schema/createSchema\";\n// tslint:disable-next-line\nvar Node = require(\"prosemirror-model\").Node;\nvar JSONLanguage = /** @class */ (function () {\n    function JSONLanguage(options, blockTypes) {\n        if (options === void 0) { options = {}; }\n        if (blockTypes === void 0) { blockTypes = [\n            new MarkdownBlock(options),\n            new DcImageLinkBlock(),\n            new DcContentLinkBlock()\n        ]; }\n        this.blockTypes = blockTypes;\n        this.name = \"json\";\n        this.label = \"JSON\";\n        var isInlineStylesEnabled = isToolEnabled(\"inline_styles\", options);\n        var schema = createSchema(options, isInlineStylesEnabled);\n        var tools = __spreadArrays(createStandardTools(schema, options), createDynamicContentTools(schema, options), createMarkdownTools(schema, options));\n        this.schema = schema;\n        this.tools = tools;\n    }\n    JSONLanguage.prototype.serialize = function (doc) {\n        var _this = this;\n        if (!doc) {\n            return [];\n        }\n        doc = doc.toJSON();\n        var fragments = [];\n        if (!doc.content || doc.content.length === 0) {\n            return fragments;\n        }\n        var nodesByConverter = groupBy(doc.content, function (node) {\n            for (var _i = 0, _a = _this.blockTypes; _i < _a.length; _i++) {\n                var blockType = _a[_i];\n                if (blockType.canSerialize(_this.schema, node)) {\n                    return blockType;\n                }\n            }\n        });\n        var blocks = [];\n        for (var _i = 0, nodesByConverter_1 = nodesByConverter; _i < nodesByConverter_1.length; _i++) {\n            var group = nodesByConverter_1[_i];\n            var groupBlocks = group.group.serialize(this.schema, group.items);\n            blocks = blocks.concat.apply(blocks, groupBlocks);\n        }\n        return blocks;\n    };\n    JSONLanguage.prototype.parse = function (blocks) {\n        var _this = this;\n        if (!blocks || blocks.length === 0) {\n            return Node.fromJSON(this.schema, {\n                type: \"doc\",\n                content: [\n                    {\n                        type: \"paragraph\"\n                    }\n                ]\n            });\n        }\n        var result = {\n            type: \"doc\",\n            content: []\n        };\n        var blocksGroupedByConverter = groupBy(blocks, function (block) {\n            for (var _i = 0, _a = _this.blockTypes; _i < _a.length; _i++) {\n                var blockType = _a[_i];\n                if (blockType.canParse(_this.schema, block)) {\n                    return blockType;\n                }\n            }\n        });\n        for (var _i = 0, blocksGroupedByConverter_1 = blocksGroupedByConverter; _i < blocksGroupedByConverter_1.length; _i++) {\n            var group = blocksGroupedByConverter_1[_i];\n            var parsedNodes = group.group.parse(this.schema, group.items);\n            result.content = result.content.concat.apply(result.content, parsedNodes);\n        }\n        return Node.fromJSON(this.schema, result);\n    };\n    return JSONLanguage;\n}());\nexport default JSONLanguage;\nfunction groupBy(items, groupFn) {\n    var result = [];\n    var currentGroup = null;\n    var currentGroupItems = [];\n    for (var _i = 0, items_1 = items; _i < items_1.length; _i++) {\n        var item = items_1[_i];\n        var itemGroup = groupFn(item);\n        if (itemGroup === undefined) {\n            continue;\n        }\n        if (currentGroup === null) {\n            currentGroup = itemGroup;\n            currentGroupItems = [item];\n        }\n        else if (currentGroup === itemGroup) {\n            currentGroupItems.push(item);\n        }\n        else {\n            if (currentGroupItems.length > 0) {\n                result.push({\n                    group: currentGroup,\n                    items: currentGroupItems\n                });\n            }\n            currentGroup = itemGroup;\n            currentGroupItems = [item];\n        }\n    }\n    if (currentGroupItems.length > 0 && currentGroup !== null) {\n        result.push({\n            group: currentGroup,\n            items: currentGroupItems\n        });\n    }\n    return result;\n}\n","export * from \"./languages\";\nexport * from \"./dialogs\";\nexport * from \"./tools\";\nexport * from \"./utils\";\n"],"sourceRoot":""}